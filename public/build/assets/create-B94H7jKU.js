import{u as Me,r as x,j as e,H as De,a as Q}from"./app-U8YXLd1t.js";import{B as v}from"./button-BIK6FZZj.js";import{C as X}from"./checkbox-CjMkKJep.js";import{I as m}from"./input-DIDqrx5K.js";import{L as l}from"./label-BPy6BQ9z.js";import{R as Ve}from"./RichTextEditor-CjiBXood.js";import{d as I,S as q,a as R,b as B,c as F}from"./select-DSR3rMaI.js";import{T as J}from"./textarea-D7LKIosO.js";import{A as $e}from"./app-layout-CdhcPiDn.js";import{t as Y}from"./index-7ujUmCNw.js";import{t as N}from"./index-Bo2RbnIz.js";import{M as Ie}from"./map-pin-Dt9cd2GL.js";import{S as Z}from"./search-DaDCtYfG.js";import{C as ee}from"./index-DXf1X9xn.js";import{T as qe}from"./trash-2-BwOlG3LX.js";import{P as se}from"./plus-BTSP3R2A.js";import{X as E}from"./x-DKlh0bgi.js";import{C as te}from"./cloud-upload-CmVK4J1t.js";import{A as re}from"./arrow-right-B2cYamb8.js";import"./app-ClQ2typU.js";import"./utils-D0Zg16Wk.js";import"./index-Hv_yU9_w.js";import"./index-B35DBIvM.js";import"./index-DCB7DMTV.js";import"./createLucideIcon-CBVvH8xR.js";import"./avatar-ChG8s8Pm.js";import"./index-Dhq0cQs_.js";import"./index-CMWG4mbA.js";import"./index-D9s5CDJa.js";import"./app-logo-icon-DyGRE7IG.js";import"./index-31lGrPGR.js";import"./index-gSLmiL6w.js";import"./index-DaohGxKX.js";import"./index-2FGh3n-F.js";import"./index-CGelz8kl.js";import"./users-Df-G5ChN.js";import"./file-text-NfpqAQTW.js";import"./badge-CNS9zTCy.js";function fs({categories:S,policies:ae,guides:Re,countries:p}){const{data:a,setData:c,post:ie,processing:G,errors:d}=Me({category_id:"",province_id:"",title:"",day:1,night:0,thumbnail:null,description:"",short_description:"",price_adult:"",price_children:"",gallery_images:[],schedules:[],tour_services:[],policy_ids:[],guide_ids:[],pricing_config:null}),[y,ne]=x.useState(""),[L,le]=x.useState(""),[M,z]=x.useState(""),[o,A]=x.useState(1),[ce,H]=x.useState(!0),de=[{id:1,title:"Thông tin chung"},{id:2,title:"Lịch trình"},{id:3,title:"Nội dung"},{id:4,title:"Hình ảnh"},{id:5,title:"Dịch vụ & Khác"},{id:6,title:"Tính giá & LN"}],[i,b]=x.useState({guestEstimate:10,guideSalaryDay:5e5,insurancePerPax:2e4,managementFee:0,profitMargin:20,taxRate:8,childrenPercentage:75}),g=x.useMemo(()=>{const s=a.tour_services.reduce((ke,Le)=>ke+Le.price_total,0),t=Math.ceil(s/i.guestEstimate),r=Math.ceil(i.guideSalaryDay*a.day/i.guestEstimate),n=t+r+i.insurancePerPax,h=n+i.managementFee,u=h*(1+i.profitMargin/100),C=Math.ceil(u*(1+i.taxRate/100)),Pe=Math.ceil(C/1e3)*1e3;return{totalServiceCost:s,serviceCostPerPax:t,guideCostPerPax:r,baseCost:n,costWithMgmt:h,priceBeforeTax:u,finalPrice:Pe}},[a.tour_services,a.day,i]),oe=()=>{c(s=>({...s,price_adult:g.finalPrice,price_children:Math.ceil(g.finalPrice*(i.childrenPercentage/100)/1e3)*1e3,pricing_config:i})),N.success("Đã áp dụng giá tính toán vào form!")},he=s=>{switch(s){case 1:return a.category_id?a.title?Number(a.day)<1?"Số ngày phải lớn hơn 0":f||!0:"Vui lòng nhập tên tour":"Vui lòng chọn danh mục";case 2:return a.province_id?w||!0:"Vui lòng chọn Tỉnh/Thành phố";case 3:return a.short_description?!0:"Vui lòng nhập mô tả ngắn";case 4:return!0;case 5:return!0;case 6:return a.price_adult?!0:"Vui lòng nhập giá người lớn (hoặc dùng công cụ tính giá)";default:return!0}},D=()=>{const s=he(o);if(s===!0){if(A(t=>Math.min(t+1,6)),window.scrollTo(0,0),o===5&&(H(!1),setTimeout(()=>H(!0),1e3)),o===1){const t=S.find(r=>String(r.id)===a.category_id);if(t){const r=t.title.toLowerCase();if(r.includes("trong nước")||r.includes("nội địa")){const n=p.find(h=>h.name.toLowerCase()==="việt nam"||h.name.toLowerCase()==="vietnam");n&&K(String(n.id))}}}}else N.error(s)},me=()=>{A(s=>Math.max(s-1,1)),window.scrollTo(0,0)},xe=x.useMemo(()=>{let s=p.filter(t=>t.name.toLowerCase().includes(L.toLowerCase()));if(a.category_id){const t=S.find(r=>String(r.id)===a.category_id);if(t){const r=t.title.toLowerCase();r.includes("quốc tế")?s=s.filter(n=>n.name.toLowerCase()!=="việt nam"):(r.includes("nội địa")||r.includes("trong nước"))&&(s=s.filter(n=>n.name.toLowerCase()==="việt nam"))}}return s},[p,L,a.category_id,S]),ue=x.useMemo(()=>(p.find(r=>String(r.id)===y)?.provinces||[]).filter(r=>r.name.toLowerCase().includes(M.toLowerCase())),[p,y,M]),j=x.useMemo(()=>{for(const s of p){const t=s.provinces?.find(r=>String(r.id)===a.province_id);if(t)return t}return null},[a.province_id,p]),T=x.useMemo(()=>j?.destinations||[],[j]),V=x.useMemo(()=>j?.providers?j.providers.flatMap(s=>(s.services||[]).map(t=>({...t,displayName:`${t.name} - ${s.name}`}))):[],[j]),K=s=>{ne(s),c(t=>({...t,province_id:"",tour_services:[]})),z("")},ge=s=>{a.province_id!==s&&c(t=>({...t,province_id:s,tour_services:[]}))},pe=(s,t)=>{if(t){const r={name:`Tham quan ${s.name}`,description:s.description||`Khám phá ${s.name}`,destination_id:String(s.id),date:a.schedules.length+1,breakfast:!0,lunch:!0,dinner:!0};c("schedules",[...a.schedules,r])}else{const r=a.schedules.filter(n=>n.destination_id!==String(s.id));c("schedules",r)}},[U,W]=x.useState(null),[$,O]=x.useState([]),_=x.useRef(null),be=s=>{const t=s.target.files?.[0];t&&(W(URL.createObjectURL(t)),c("thumbnail",t))},je=s=>{s.stopPropagation(),W(null),c("thumbnail",null),_.current&&(_.current.value="")},ve=s=>{const t=Array.from(s.target.files||[]);if(t.length>0){const r=t.map(n=>URL.createObjectURL(n));O(n=>[...n,...r]),c("gallery_images",[...a.gallery_images,...t])}},Ne=s=>{const t=[...$];t.splice(s,1),O(t);const r=[...a.gallery_images];r.splice(s,1),c("gallery_images",r)},ye=()=>{if(!a.province_id){N.error("Vui lòng chọn Tỉnh/Thành phố ở phần trên trước.");return}c("schedules",[...a.schedules,{name:"",description:"",destination_id:"",date:a.schedules.length+1,breakfast:!1,lunch:!0,dinner:!0}])},fe=s=>{const t=[...a.schedules];t.splice(s,1),c("schedules",t)},P=(s,t,r)=>{const n=[...a.schedules];n[s]={...n[s],[t]:r},c("schedules",n)},we=()=>{if(!a.province_id){N.error("Vui lòng chọn Tỉnh/Thành phố trước khi thêm dịch vụ.");return}c("tour_services",[...a.tour_services,{service_id:"",quantity:1,unit:"Lần",price_unit:0,price_total:0,description:""}])},Ce=s=>{const t=[...a.tour_services];t.splice(s,1),c("tour_services",t)},k=(s,t,r)=>{const n=[...a.tour_services],h={...n[s]};if(h[t]=r,t==="service_id"){const u=V.find(C=>String(C.id)===r);u&&(h.price_unit=Number(u.price),h.unit=u.unit||"Lần",h.service_name=u.name,h.price_total=h.quantity*h.price_unit)}if(t==="quantity"||t==="price_unit"){const u=t==="quantity"?Number(r):h.quantity,C=t==="price_unit"?Number(r):h.price_unit;h.price_total=u*C}n[s]=h,c("tour_services",n)},Se=(s,t)=>{const r=a[s];r.includes(t)?c(s,r.filter(n=>n!==t)):c(s,[...r,t])},Te=s=>{const t=Number(s);c("day",t)},f=x.useMemo(()=>{const s=Number(a.day),t=Number(a.night);return t>s?"Số đêm không được lớn hơn số ngày.":s-t>1?"Số đêm không được ít hơn số ngày quá 1 (chênh tối đa 1).":""},[a.night,a.day]),w=x.useMemo(()=>Number(a.day)>0&&a.schedules.length!==Number(a.day)?`Cần ${a.day} ngày lịch trình, hiện có ${a.schedules.length}.`:"",[a.day,a.schedules.length]),_e=s=>{if(s.preventDefault(),f){N.error(f);return}if(w){N.error(w);return}if(!a.price_adult){N.error("Vui lòng nhập giá người lớn (ở Bước 6)");return}if(o<6){s.preventDefault(),D();return}ie(Y.store().url,{forceFormData:!0,onSuccess:t=>{const r=t.props.tour?.id||t.props.template?.id;r?Q.visit(`/tours/${r}/instances/create`):Q.visit(Y.index().url)}})};return x.useEffect(()=>{const s=document.getElementById("active-step");s&&s.scrollIntoView({behavior:"smooth",block:"nearest",inline:"center"})},[o]),e.jsxs($e,{breadcrumbs:[{title:"Tạo Tour Mới",href:"#"}],children:[e.jsx(De,{title:"Tạo Tour Mới"}),e.jsx("div",{className:"min-h-screen bg-gray-50 p-8 pb-32",children:e.jsxs("form",{onSubmit:_e,className:"mx-auto max-w-7xl space-y-8",children:[e.jsxs("div",{className:"flex flex-col gap-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Tạo Tour Mới"}),e.jsxs("div",{className:"text-sm font-medium text-gray-500",children:["Bước ",o,"/6"]})]}),e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2.5 mb-6",children:e.jsx("div",{className:"bg-blue-600 h-2.5 rounded-full transition-all duration-300 ease-in-out",style:{width:`${o/6*100}%`}})}),e.jsx("div",{className:"flex justify-between items-center mb-6 overflow-x-auto pb-2 no-scrollbar",children:de.map(s=>e.jsxs("div",{id:s.id===o?"active-step":void 0,className:`flex items-center gap-2 px-4 py-2 rounded-full text-sm font-medium whitespace-nowrap transition-colors
                                        ${s.id===o?"bg-blue-100 text-blue-700 border border-blue-200":s.id<o?"text-green-600 bg-green-50":"text-gray-400 bg-gray-50"}`,children:[e.jsx("div",{className:`w-6 h-6 rounded-full flex items-center justify-center text-xs
                                        ${s.id===o?"bg-blue-600 text-white":s.id<o?"bg-green-500 text-white":"bg-gray-300 text-white"}
                                    `,children:s.id}),s.title]},s.id))})]}),e.jsx("div",{className:o===1?"block":"hidden",children:e.jsxs("div",{className:"rounded-lg border border-gray-200 bg-white p-6 shadow-sm",children:[e.jsx("h2",{className:"mb-6 border-b pb-4 text-xl font-semibold text-gray-800",children:"1. Thông tin cơ bản"}),e.jsx("div",{className:"grid grid-cols-1 gap-6 md:grid-cols-2",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsxs(l,{children:["Danh mục"," ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs(I,{onValueChange:s=>c("category_id",s),value:a.category_id,children:[e.jsx(q,{className:d.category_id?"border-red-500":"",children:e.jsx(R,{placeholder:"-- Chọn danh mục --"})}),e.jsx(B,{children:S.map(s=>e.jsx(F,{value:String(s.id),children:s.title},s.id))})]}),d.category_id&&e.jsx("p",{className:"mt-1 text-xs text-red-500",children:d.category_id})]}),e.jsxs("div",{children:[e.jsxs(l,{children:["Tên Tour"," ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx(m,{value:a.title,onChange:s=>c("title",s.target.value),placeholder:"VD: Tour Khám Phá...",className:d.title?"border-red-500":""}),d.title&&e.jsx("p",{className:"mt-1 text-xs text-red-500",children:d.title})]})]})}),e.jsxs("div",{className:"mt-6 grid grid-cols-1 gap-6 md:grid-cols-2",children:[e.jsxs("div",{children:[e.jsx(l,{children:"Số ngày"}),e.jsx(m,{type:"number",value:a.day,onChange:s=>Te(s.target.value),onFocus:s=>s.target.select()})]}),e.jsxs("div",{children:[e.jsx(l,{children:"Số đêm"}),e.jsx(m,{type:"number",value:a.night,onChange:s=>c("night",Number(s.target.value)),onFocus:s=>s.target.select()}),f&&e.jsx("p",{className:"mt-1 text-xs text-red-500",children:f})]})]})]})}),e.jsx("div",{className:o===2?"block":"hidden",children:e.jsxs("div",{className:"rounded-lg border border-gray-200 bg-white p-6 shadow-sm",children:[e.jsx("h2",{className:"mb-6 border-b pb-4 text-xl font-semibold text-gray-800",children:"2. Địa điểm & Lịch trình"}),e.jsxs("div",{className:"mb-8",children:[e.jsx(l,{className:"mb-2 block text-base font-semibold text-blue-700",children:"Chọn Địa điểm để tạo lịch trình tự động"}),e.jsxs("div",{className:"grid h-[450px] grid-cols-1 overflow-hidden rounded-lg border bg-white shadow-sm md:grid-cols-3",children:[e.jsxs("div",{className:"flex flex-col border-r",children:[e.jsxs("div",{className:"flex items-center gap-2 border-b bg-gray-50 p-3 font-semibold text-gray-700",children:[e.jsx(Ie,{className:"h-4 w-4"})," Quốc gia"]}),e.jsx("div",{className:"border-b p-2",children:e.jsxs("div",{className:"relative",children:[e.jsx(Z,{className:"absolute top-2.5 left-2 h-4 w-4 text-gray-500"}),e.jsx(m,{placeholder:"Tìm quốc gia...",className:"h-9 pl-8",value:L,onChange:s=>le(s.target.value)})]})}),e.jsx("div",{className:"scrollbar-thin scrollbar-thumb-gray-200 flex-1 space-y-1 overflow-y-auto p-2",children:xe.map(s=>e.jsxs("button",{type:"button",onClick:()=>K(String(s.id)),className:`flex w-full items-center justify-between rounded-md px-3 py-2 text-left text-sm transition-colors ${String(s.id)===y?"bg-blue-600 text-white":"text-gray-700 hover:bg-gray-100"}`,children:[e.jsx("span",{children:s.name}),String(s.id)===y&&e.jsx(ee,{className:"h-4 w-4"})]},s.id))})]}),e.jsxs("div",{className:"flex flex-col border-r",children:[e.jsx("div",{className:"border-b bg-gray-50 p-3 font-semibold text-gray-700",children:"Tỉnh / Thành phố"}),e.jsx("div",{className:"border-b p-2",children:e.jsxs("div",{className:"relative",children:[e.jsx(Z,{className:"absolute top-2.5 left-2 h-4 w-4 text-gray-500"}),e.jsx(m,{placeholder:"Tìm tỉnh thành...",className:"h-9 pl-8",value:M,onChange:s=>z(s.target.value),disabled:!y})]})}),e.jsxs("div",{className:"scrollbar-thin scrollbar-thumb-gray-200 flex-1 space-y-1 overflow-y-auto p-2",children:[!y&&e.jsx("div",{className:"py-4 text-center text-sm text-gray-400",children:"← Chọn quốc gia trước"}),ue.map(s=>e.jsxs("button",{type:"button",onClick:()=>ge(String(s.id)),className:`flex w-full items-center justify-between rounded-md px-3 py-2 text-left text-sm transition-colors ${String(s.id)===a.province_id?"bg-blue-100 font-medium text-blue-700":"text-gray-700 hover:bg-gray-100"}`,children:[s.name,String(s.id)===a.province_id&&e.jsx(ee,{className:"h-4 w-4"})]},s.id))]})]}),e.jsxs("div",{className:"flex flex-col bg-gray-50/50",children:[e.jsx("div",{className:"border-b bg-gray-50 p-3 font-semibold text-gray-700",children:"Địa điểm du lịch"}),e.jsxs("div",{className:"scrollbar-thin scrollbar-thumb-gray-200 flex-1 space-y-3 overflow-y-auto p-3",children:[!a.province_id&&e.jsx("div",{className:"py-4 text-center text-sm text-gray-400",children:"← Chọn tỉnh thành để xem địa điểm"}),a.province_id&&T.length===0&&e.jsx("div",{className:"py-4 text-center text-sm text-gray-400",children:"Chưa có dữ liệu địa điểm"}),T.map(s=>{const t=a.schedules.some(r=>r.destination_id===String(s.id));return e.jsxs("div",{className:`flex cursor-pointer items-start space-x-3 rounded-md border p-3 transition-all ${t?"border-green-200 bg-green-50":"bg-white hover:border-blue-300"}`,children:[e.jsx(X,{id:`dest-${s.id}`,checked:t,onCheckedChange:r=>pe(s,r)}),e.jsxs("div",{className:"grid gap-1.5 leading-none",children:[e.jsx("label",{htmlFor:`dest-${s.id}`,className:"cursor-pointer text-sm leading-none font-medium peer-disabled:cursor-not-allowed peer-disabled:opacity-70",children:s.name}),e.jsx("p",{className:"line-clamp-2 text-xs text-gray-500",children:s.description||"Không có mô tả"})]})]},s.id)})]})]})]}),d.province_id&&e.jsx("p",{className:"mt-2 text-sm text-red-500",children:d.province_id})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"scrollbar-thin max-h-[600px] space-y-4 overflow-y-auto pr-2",children:[a.schedules.length===0&&e.jsx("div",{className:"flex h-32 flex-col items-center justify-center rounded-lg border border-dashed bg-gray-50 text-gray-500",children:e.jsx("p",{children:"Chưa có lịch trình nào."})}),w&&e.jsx("div",{className:"rounded border border-yellow-200 bg-yellow-50 p-3 text-sm text-yellow-700",children:w}),a.schedules.map((s,t)=>e.jsxs("div",{className:"relative rounded-lg border border-gray-200 bg-gray-50 p-4 hover:border-blue-300 hover:shadow-sm",children:[e.jsx("button",{type:"button",onClick:()=>fe(t),className:"absolute top-4 right-4 text-gray-400 hover:text-red-500",children:e.jsx(qe,{className:"h-5 w-5"})}),e.jsxs("div",{className:"grid grid-cols-1 gap-4 md:grid-cols-12",children:[e.jsxs("div",{className:"md:col-span-2",children:[e.jsx(l,{className:"text-xs text-gray-500",children:"Ngày"}),e.jsx(m,{type:"number",min:"1",className:"bg-white",value:s.date,onChange:r=>P(t,"date",r.target.value)})]}),e.jsxs("div",{className:"md:col-span-6",children:[e.jsx(l,{className:"text-xs text-gray-500",children:"Hoạt động"}),e.jsx(m,{className:"bg-white font-medium",placeholder:"VD: Tham quan...",value:s.name,onChange:r=>P(t,"name",r.target.value)})]}),e.jsxs("div",{className:"md:col-span-4",children:[e.jsxs(l,{className:"text-xs text-gray-500",children:["Địa điểm"," ",j?`(${j.name})`:""]}),e.jsxs(I,{value:String(s.destination_id),onValueChange:r=>P(t,"destination_id",r),children:[e.jsx(q,{className:"bg-white",children:e.jsx(R,{placeholder:"Chọn điểm đến"})}),e.jsx(B,{children:T.length>0?T.map(r=>{const n=a.schedules.some((h,u)=>u!==t&&String(h.destination_id)===String(r.id));return e.jsxs(F,{value:String(r.id),disabled:n,children:[r.name," ",n?"(Đã chọn)":""]},r.id)}):e.jsx("div",{className:"p-2 text-center text-xs text-gray-500",children:"Chưa có địa điểm nào"})})]})]}),e.jsxs("div",{className:"md:col-span-12",children:[e.jsx(l,{className:"text-xs text-gray-500",children:"Chi tiết"}),e.jsx(J,{className:"bg-white",rows:2,value:s.description,onChange:r=>P(t,"description",r.target.value)})]})]})]},t))]}),e.jsx("div",{className:"mt-4 flex justify-center border-t pt-2",children:e.jsxs(v,{type:"button",size:"sm",onClick:ye,className:"w-full md:w-auto",children:[e.jsx(se,{className:"mr-1 h-4 w-4"})," Thêm Ngày"]})})]})]})}),e.jsx("div",{className:o===3?"block":"hidden",children:e.jsxs("div",{className:"rounded-lg border border-gray-200 bg-white p-6 shadow-sm",children:[e.jsx("h2",{className:"mb-6 border-b pb-4 text-xl font-semibold text-gray-800",children:"3. Nội dung mô tả"}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx(l,{className:"mb-2 block font-medium",children:"Mô tả ngắn (Tóm tắt)"}),e.jsx(J,{rows:3,value:a.short_description,onChange:s=>c("short_description",s.target.value),className:d.short_description?"border-red-500":""}),d.short_description&&e.jsx("p",{className:"mt-1 text-xs text-red-500",children:d.short_description})]}),e.jsxs("div",{children:[e.jsx(l,{className:"mb-2 block font-medium",children:"Mô tả chi tiết"}),e.jsx("div",{className:`rounded-md border ${d.description?"border-red-500":"border-gray-300"}`,children:e.jsx(Ve,{value:a.description,onChange:s=>c("description",s),height:400})}),d.description&&e.jsx("p",{className:"mt-1 text-xs text-red-500",children:d.description})]})]})]})}),e.jsx("div",{className:o===4?"block":"hidden",children:e.jsxs("div",{className:"rounded-lg border border-gray-200 bg-white p-6 shadow-sm",children:[e.jsx("h2",{className:"mb-6 border-b pb-4 text-xl font-semibold text-gray-800",children:"4. Thư viện hình ảnh"}),e.jsxs("div",{className:"grid grid-cols-1 gap-8 md:grid-cols-3",children:[e.jsxs("div",{className:"md:col-span-1",children:[e.jsxs(l,{className:"mb-3 block font-medium",children:["Ảnh đại diện"," ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("div",{className:`relative flex h-48 w-full cursor-pointer flex-col items-center justify-center rounded-lg border-2 border-dashed bg-gray-50 hover:bg-gray-100 ${d.thumbnail?"border-red-500":"border-gray-300"}`,onClick:()=>_.current?.click(),children:[U?e.jsxs(e.Fragment,{children:[e.jsx("img",{src:U,className:"h-full w-full rounded-lg object-cover"}),e.jsx("button",{type:"button",onClick:je,className:"absolute top-2 right-2 rounded-full bg-red-600 p-1 text-white shadow-sm hover:bg-red-700",children:e.jsx(E,{className:"h-4 w-4"})})]}):e.jsxs("div",{className:"text-center",children:[e.jsx(te,{className:"mx-auto mb-2 h-10 w-10 text-gray-400"}),e.jsx("span",{className:"text-sm text-gray-500",children:"Tải ảnh lên"})]}),e.jsx("input",{type:"file",ref:_,className:"hidden",accept:"image/*",onChange:be})]}),d.thumbnail&&e.jsx("p",{className:"mt-1 text-xs text-red-500",children:d.thumbnail})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx(l,{className:"mb-3 block font-medium",children:"Bộ sưu tập ảnh"}),e.jsxs("div",{className:"rounded-lg border border-gray-200 p-4",children:[e.jsx("div",{className:"mb-4 flex items-center justify-center rounded-lg border-2 border-dashed border-gray-300 bg-gray-50 py-8 hover:bg-gray-100",children:e.jsxs("label",{className:"cursor-pointer text-center",children:[e.jsx(te,{className:"mx-auto mb-2 h-8 w-8 text-gray-400"}),e.jsx("span",{className:"text-sm font-medium text-gray-600",children:"Thêm nhiều ảnh"}),e.jsx("input",{type:"file",multiple:!0,className:"hidden",accept:"image/*",onChange:ve})]})}),$.length>0&&e.jsx("div",{className:"grid grid-cols-4 gap-4 sm:grid-cols-5 md:grid-cols-6",children:$.map((s,t)=>e.jsxs("div",{className:"group relative aspect-square overflow-hidden rounded-md border",children:[e.jsx("img",{src:s,className:"h-full w-full object-cover"}),e.jsx("button",{type:"button",onClick:()=>Ne(t),className:"absolute top-1 right-1 hidden rounded-full bg-red-600 p-0.5 text-white shadow-sm group-hover:block",children:e.jsx(E,{className:"h-3 w-3"})})]},t))}),d.gallery_images&&e.jsx("p",{className:"mt-2 text-xs text-red-500",children:d.gallery_images})]})]})]})]})}),e.jsx("div",{className:o===5?"block":"hidden",children:e.jsxs("div",{className:"grid grid-cols-1 gap-6 md:grid-cols-3",children:[e.jsxs("div",{className:"rounded-lg border border-gray-200 bg-white p-6 shadow-sm md:col-span-3",children:[e.jsxs("div",{className:"mb-4 flex items-center justify-between border-b pb-2",children:[e.jsx("h3",{className:"text-lg font-bold text-gray-800",children:"5. Dịch vụ đi kèm"}),e.jsxs(v,{type:"button",size:"sm",variant:"outline",onClick:we,children:[e.jsx(se,{className:"mr-1 h-4 w-4"})," Thêm Dịch vụ"]})]}),!a.province_id&&e.jsxs("div",{className:"mb-4 rounded border border-yellow-200 bg-yellow-50 p-3 text-sm text-yellow-700",children:["Vui lòng chọn"," ",e.jsx("strong",{children:"Tỉnh/Thành phố"})," để hiển thị danh sách nhà cung cấp dịch vụ."]}),e.jsx("div",{className:"scrollbar-thin max-h-[600px] space-y-4 overflow-y-auto pr-2",children:a.tour_services.map((s,t)=>e.jsxs("div",{className:"relative flex flex-col gap-4 rounded-lg border bg-gray-50 p-4 hover:border-blue-300 md:flex-row md:items-start",children:[e.jsx("button",{type:"button",onClick:()=>Ce(t),className:"absolute -top-2 -right-2 rounded-full border bg-white p-1 text-red-500 shadow-sm hover:bg-red-50",children:e.jsx(E,{className:"h-4 w-4"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx(l,{className:"text-xs text-gray-500",children:"Tên dịch vụ"}),e.jsxs(I,{value:s.service_id,onValueChange:r=>k(t,"service_id",r),children:[e.jsx(q,{className:"mt-1 bg-white",children:e.jsx(R,{placeholder:"Chọn dịch vụ..."})}),e.jsx(B,{children:V.length>0?V.map(r=>e.jsx(F,{value:String(r.id),children:r.displayName},r.id)):e.jsx("div",{className:"p-2 text-center text-xs text-gray-500",children:"Không có dịch vụ nào"})})]})]}),e.jsxs("div",{className:"w-24",children:[e.jsx(l,{className:"text-xs text-gray-500",children:"SL"}),e.jsx(m,{type:"number",min:"1",className:"mt-1 bg-white",value:s.quantity,onChange:r=>k(t,"quantity",r.target.value)})]}),e.jsxs("div",{className:"w-24",children:[e.jsx(l,{className:"text-xs text-gray-500",children:"Đơn vị"}),e.jsx(m,{className:"mt-1 bg-white",value:s.unit,onChange:r=>k(t,"unit",r.target.value)})]}),e.jsxs("div",{className:"w-32",children:[e.jsx(l,{className:"text-xs text-gray-500",children:"Đơn giá"}),e.jsx(m,{type:"number",className:"mt-1 bg-white",value:s.price_unit,onChange:r=>k(t,"price_unit",r.target.value)})]}),e.jsxs("div",{className:"w-32",children:[e.jsx(l,{className:"text-xs text-gray-500",children:"Thành tiền"}),e.jsx("div",{className:"mt-1 flex h-10 items-center rounded-md border bg-gray-100 px-3 font-bold text-green-600",children:new Intl.NumberFormat("vi-VN",{style:"decimal"}).format(s.price_total)})]})]},t))})]}),e.jsxs("div",{className:"rounded-lg border border-gray-200 bg-white p-6 shadow-sm md:col-span-3",children:[e.jsx("h3",{className:"mb-4 font-semibold text-gray-800",children:"Chính sách"}),e.jsx("div",{className:"max-h-60 space-y-2 overflow-y-auto pr-2",children:ae.map(s=>e.jsxs("label",{className:"flex cursor-pointer items-start gap-2 rounded border p-2 hover:bg-gray-50",children:[e.jsx(X,{className:"mt-0.5",checked:a.policy_ids.includes(s.id),onCheckedChange:()=>Se("policy_ids",s.id)}),e.jsx("span",{className:"text-sm text-gray-700",children:s.title})]},s.id))})]})]})}),e.jsx("div",{className:o===6?"block":"hidden",children:e.jsxs("div",{className:"rounded-lg border border-gray-200 bg-white p-6 shadow-sm",children:[e.jsx("h2",{className:"mb-6 border-b pb-4 text-xl font-semibold text-gray-800",children:"6. Công cụ Tính giá & Lợi nhuận"}),e.jsxs("div",{className:"grid grid-cols-1 gap-8 md:grid-cols-2",children:[e.jsxs("div",{className:"space-y-6 rounded-lg bg-gray-50 p-4 border border-gray-200",children:[e.jsx("h3",{className:"font-semibold text-blue-700 uppercase p-2 bg-blue-50 rounded",children:"1. Tham số tính toán"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{children:"Số khách dự kiến (Người)"}),e.jsx(m,{type:"number",value:i.guestEstimate,onChange:s=>b({...i,guestEstimate:Number(s.target.value)}),className:"bg-white"}),e.jsx("p",{className:"text-xs text-gray-500",children:"Dùng để chia đều chi phí cố định."})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{children:"Lương Guide/Ngày"}),e.jsx(m,{type:"number",min:"0",value:i.guideSalaryDay,onChange:s=>b({...i,guideSalaryDay:Number(s.target.value)}),className:"bg-white"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{children:"Bảo hiểm/Người"}),e.jsx(m,{type:"number",min:"0",value:i.insurancePerPax,onChange:s=>b({...i,insurancePerPax:Number(s.target.value)}),className:"bg-white"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{children:"Phí quản lý/Người"}),e.jsx(m,{type:"number",min:"0",value:i.managementFee,onChange:s=>b({...i,managementFee:Number(s.target.value)}),className:"bg-white"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{children:"Lợi nhuận mục tiêu (%)"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(m,{type:"number",min:"0",max:"100",value:i.profitMargin,onChange:s=>b({...i,profitMargin:Number(s.target.value)}),className:"bg-white"}),e.jsx("span",{className:"font-bold text-gray-600",children:"%"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{children:"Thuế VAT (%)"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(m,{type:"number",min:"0",max:"100",value:i.taxRate,onChange:s=>b({...i,taxRate:Number(s.target.value)}),className:"bg-white"}),e.jsx("span",{className:"font-bold text-gray-600",children:"%"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{children:"Tỷ lệ giá Trẻ em (%)"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(m,{type:"number",min:"0",max:"100",value:i.childrenPercentage,onChange:s=>b({...i,childrenPercentage:Number(s.target.value)}),className:"bg-white"}),e.jsx("span",{className:"font-bold text-gray-600",children:"%"})]}),e.jsx("p",{className:"text-xs text-gray-500",children:"Thường là 50%, 75% hoặc 100% giá người lớn."})]})]}),e.jsxs("div",{className:"pt-4 border-t",children:[e.jsx("h4",{className:"font-medium text-sm text-gray-700 mb-2",children:"Tổng hợp Dịch vụ đã chọn:"}),e.jsxs("div",{className:"text-sm bg-white p-3 rounded border max-h-40 overflow-y-auto",children:[a.tour_services.length===0?e.jsx("span",{className:"text-gray-400",children:"Chưa chọn dịch vụ nào"}):a.tour_services.map((s,t)=>e.jsxs("div",{className:"flex justify-between py-1 border-b last:border-0 border-dashed",children:[e.jsx("span",{className:"truncate w-2/3",children:s.service_name}),e.jsx("span",{className:"font-medium",children:s.price_total.toLocaleString()})]},t)),e.jsxs("div",{className:"flex justify-between mt-2 pt-2 border-t font-bold text-blue-600",children:[e.jsx("span",{children:"Tổng tiền dịch vụ:"}),e.jsxs("span",{children:[g.totalServiceCost.toLocaleString()," đ"]})]})]})]})]}),e.jsxs("div",{className:"space-y-6 rounded-lg bg-green-50 p-4 border border-green-200 h-fit",children:[e.jsx("h3",{className:"font-semibold text-green-700 uppercase p-2 bg-green-100 rounded",children:"2. Bảng giá thành (Ước tính)"}),e.jsxs("div",{className:"space-y-3 text-sm",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-gray-600",children:"Chi phí dịch vụ/khách:"}),e.jsxs("span",{className:"font-medium",children:[g.serviceCostPerPax.toLocaleString()," đ"]})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-gray-600",children:"Chi phí Guide/khách:"}),e.jsxs("span",{className:"font-medium",children:[g.guideCostPerPax.toLocaleString()," đ"]})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-gray-600",children:"Bảo hiểm:"}),e.jsxs("span",{className:"font-medium",children:[i.insurancePerPax.toLocaleString()," đ"]})]}),e.jsx("div",{className:"border-t border-green-200 my-2"}),e.jsxs("div",{className:"flex justify-between items-center font-bold text-gray-700",children:[e.jsx("span",{children:"GIÁ VỐN (Base Cost):"}),e.jsxs("span",{children:[g.baseCost.toLocaleString()," đ"]})]}),e.jsx("div",{className:"flex justify-between items-center text-gray-500 text-xs",children:e.jsxs("span",{children:["(+ Phí quản lý ",i.managementFee.toLocaleString(),"đ)"]})}),e.jsx("div",{className:"border-t border-green-200 my-2"}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("span",{className:"text-gray-600",children:["Lợi nhuận (",i.profitMargin,"%):"]}),e.jsxs("span",{className:"font-medium text-green-600",children:["+",Math.ceil(g.costWithMgmt*i.profitMargin/100).toLocaleString()," đ"]})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("span",{className:"text-gray-600",children:["Thuế (",i.taxRate,"%):"]}),e.jsxs("span",{className:"font-medium text-orange-600",children:["+",Math.ceil(g.priceBeforeTax*i.taxRate/100).toLocaleString()," đ"]})]}),e.jsx("div",{className:"border-t-2 border-green-500 my-3"}),e.jsxs("div",{className:"flex justify-between items-center text-xl font-bold text-blue-700",children:[e.jsx("span",{children:"GIÁ BÁN GỢI Ý:"}),e.jsxs("span",{children:[g.finalPrice.toLocaleString()," đ"]})]}),e.jsx("p",{className:"text-center text-xs text-gray-500",children:"(Đã làm tròn đến hàng nghìn)"})]}),e.jsx(v,{type:"button",className:"w-full bg-blue-600 hover:bg-blue-700 mt-4",onClick:oe,children:"Áp dụng giá này vào form"}),e.jsxs("div",{className:"mt-6 pt-4 border-t border-green-300",children:[e.jsx("h4",{className:"font-bold text-gray-800 mb-3 uppercase",children:"Giá niêm yết (Final)"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsxs(l,{className:"text-blue-800",children:["Giá người lớn (VND)"," ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx(m,{type:"number",placeholder:"VD: 5000000",value:a.price_adult,onChange:s=>c("price_adult",s.target.value),className:`bg-white font-bold text-lg ${d.price_adult?"border-red-500":"border-blue-300"}`}),d.price_adult&&e.jsx("p",{className:"mt-1 text-xs text-red-500",children:d.price_adult})]}),e.jsxs("div",{children:[e.jsxs(l,{className:"text-blue-800",children:["Giá trẻ em (VND)"," "]}),e.jsx(m,{type:"number",placeholder:"VD: 3000000",value:a.price_children,onChange:s=>c("price_children",s.target.value),className:`bg-white font-bold text-lg ${d.price_children?"border-red-500":"border-blue-300"}`}),d.price_children&&e.jsx("p",{className:"mt-1 text-xs text-red-500",children:d.price_children})]})]})]})]})]})]})}),e.jsx("div",{className:"fixed bottom-6 left-1/2 z-50 w-full max-w-4xl -translate-x-1/2 rounded-full border bg-white px-6 py-3 shadow-2xl",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(v,{type:"button",variant:"outline",size:"lg",onClick:o===1?()=>window.history.back():me,className:"min-w-[120px]",children:o===1?"Hủy bỏ":"Quay lại"}),e.jsx("div",{className:"flex gap-4",children:o===5?e.jsxs(v,{type:"button",size:"lg",onClick:D,className:"min-w-[150px] bg-indigo-600 hover:bg-indigo-700",children:["Tính giá tiền & LN ",e.jsx(re,{className:"ml-2 h-4 w-4"})]}):o<6?e.jsxs(v,{type:"button",size:"lg",onClick:D,className:"min-w-[150px] bg-blue-600 hover:bg-blue-700",children:["Tiếp tục ",e.jsx(re,{className:"ml-2 h-4 w-4"})]}):e.jsx(v,{type:"submit",disabled:G||!ce,size:"lg",className:"min-w-[200px] bg-green-600 hover:bg-green-700 disabled:opacity-50",children:G?"Đang tạo...":"Hoàn tất & Tạo Tour"})})]})})]})})]})}export{fs as default};
