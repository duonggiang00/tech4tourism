import{r as n,j as e,d as j}from"./app-CaSGj1uT.js";import{B as y}from"./button-BZEXzofL.js";import{d as N,c as b,D as C,a as D,b as q}from"./dialog-C6DnRKYe.js";import{I as l}from"./input-DS6fKu5u.js";import{L as c}from"./label-D5A-ek0L.js";import{d as E,S as L,a as $,b as w,c as S}from"./select-BLjx6kkv.js";import{T as V}from"./textarea-DBZrNJqr.js";import{t as o}from"./index-D9FVAaNM.js";import"./app-C1CjLIM7.js";import"./utils-D0Zg16Wk.js";import"./index-P0NC3ElT.js";import"./index-Dc8D3YAC.js";import"./x-BJwh83_V.js";import"./createLucideIcon-B2IF2C91.js";import"./index-B35KFXzL.js";import"./index-5xdvLrBf.js";function X({open:d,onOpenChange:u,tourId:m,availableServices:h=[],editingTourService:i,onSuccess:v}){const[f,x]=n.useState(!1),[t,r]=n.useState({service_id:"",quantity:1,unit:"",price_unit:0,price_total:0,description:""});n.useEffect(()=>{d&&r(i?{service_id:String(i.service_id),quantity:i.quantity,unit:i.unit,price_unit:i.price_unit,price_total:i.price_total,description:i.description||""}:{service_id:"",quantity:1,unit:"",price_unit:0,price_total:0,description:""})},[d,i]),n.useEffect(()=>{r(s=>({...s,price_total:s.quantity*s.price_unit}))},[t.quantity,t.price_unit]);const g=s=>{const a=h.find(p=>p.id===Number(s));a&&r(p=>({...p,service_id:s,unit:a.unit||"",price_unit:a.price}))},_=async s=>{if(s.preventDefault(),!t.service_id)return o.error("Vui lòng chọn dịch vụ");x(!0);try{const a={...t,service_id:Number(t.service_id)};i?(await j.put(`/tours/${m}/tourservices/${i.id}`,a),o.success("Cập nhật thành công")):(await j.post(`/tours/${m}/tourservices`,a),o.success("Thêm mới thành công")),v?.(),u(!1)}catch(a){console.error("API Error:",a),o.error("Có lỗi xảy ra: "+(a.response?.data?.message||"Lỗi server"))}finally{x(!1)}};return e.jsx(N,{open:d,onOpenChange:u,children:e.jsxs(b,{className:"max-w-lg",children:[e.jsx(C,{children:e.jsx(D,{children:i?"Cập nhật dịch vụ đi kèm":"Thêm dịch vụ vào Tour"})}),e.jsxs("form",{onSubmit:_,className:"space-y-4 py-2",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsxs(c,{children:["Dịch vụ ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs(E,{value:t.service_id,onValueChange:g,children:[e.jsx(L,{children:e.jsx($,{placeholder:"-- Chọn dịch vụ --"})}),e.jsx(w,{children:h?.length>0?h.map(s=>e.jsx(S,{value:String(s.id),children:s.name},s.id)):e.jsx("div",{className:"p-2 text-center text-sm text-gray-500",children:"Chưa có dữ liệu dịch vụ"})})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx(c,{children:"Số lượng"}),e.jsx(l,{type:"number",min:1,value:t.quantity,onChange:s=>r({...t,quantity:Number(s.target.value)})})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(c,{children:"Đơn vị tính"}),e.jsx(l,{value:t.unit,onChange:s=>r({...t,unit:s.target.value})})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx(c,{children:"Đơn giá ($)"}),e.jsx(l,{type:"number",value:t.price_unit,onChange:s=>r({...t,price_unit:Number(s.target.value)})})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(c,{children:"Thành tiền ($)"}),e.jsx(l,{value:t.price_total,readOnly:!0,className:"bg-gray-100 font-bold text-blue-600"})]})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(c,{children:"Ghi chú"}),e.jsx(V,{rows:3,value:t.description,onChange:s=>r({...t,description:s.target.value}),placeholder:"Ghi chú cho dịch vụ này..."})]}),e.jsxs(q,{children:[e.jsx(y,{variant:"outline",type:"button",onClick:()=>u(!1),children:"Hủy"}),e.jsx(y,{type:"submit",disabled:f,children:"Lưu lại"})]})]})]})})}export{X as TourServiceDialog};
