import{r as n,d as u,a as E,j as e,H as G,L as j}from"./app-jK4qC5mS.js";import{B as X}from"./badge-CgsJR6-J.js";import{B as y}from"./button-CbjqQSYC.js";import{b as S,C,a as L,c as $}from"./card-B4BPmPsF.js";import{T as q,a as U,b as x,c as p}from"./tabs-CNllEs7V.js";import{t as k}from"./index-7ujUmCNw.js";import{t as o}from"./index-DP83cKko.js";import{A as z}from"./app-layout-CRug86Ft.js";import K from"./TourGallery-BfGHbTTJ.js";import R from"./TourGuideList-MCyheybY.js";import W from"./TourHeader-TZtAk2p2.js";import J from"./TourInfoCards-BVINBXKt.js";import O from"./TourPolicyList-cHO-eJ7H.js";import Q from"./TourScheduleList-DgR4XSQs.js";import Y from"./TourServiceList-DPd_lkCn.js";import{C as P,U as Z}from"./users-BMKuDtIB.js";import{P as F}from"./plus-CqA-SAzD.js";import{S as D}from"./square-pen-B9WegB-A.js";import"./app-B32Q6Rc9.js";import"./utils-D0Zg16Wk.js";import"./index-DrepN1D_.js";import"./index-BY1UvJ8l.js";import"./index-CD0XU3oY.js";import"./createLucideIcon-Dv7VkWmT.js";import"./index-CMWG4mbA.js";import"./x-CqTXyibP.js";import"./avatar-ApwrDypj.js";import"./index-Dhq0cQs_.js";import"./index-D9s5CDJa.js";import"./app-logo-icon-BgMMptVa.js";import"./index-31lGrPGR.js";import"./index-gSLmiL6w.js";import"./index-DaohGxKX.js";import"./index-2FGh3n-F.js";import"./index-CGelz8kl.js";import"./file-text-B4sExV2-.js";import"./trash-2-CnNKrcSB.js";import"./arrow-left-DlJQJ3pB.js";import"./pencil-BxEn5tA-.js";import"./helperInfoItem-Ci3L3UNB.js";import"./dollar-sign-C9SewBpy.js";import"./clock-Cmnyr8BH.js";import"./map-pin-D4UHYmQp.js";import"./eye-BKvQaNEo.js";import"./shield-check-CuWf3zZp.js";import"./separator-65MnbwlF.js";import"./package-C5bqDjv-.js";const ee=s=>{const[d,c]=n.useState(!1);if(!s)return{galleryImages:[],schedules:[],tourServices:[],assignments:[],tourPolicies:[],loading:!1,refreshData:()=>{},deleteService:()=>{},deleteImage:()=>{},deleteSchedule:()=>{},deleteTour:()=>{},deletePolicy:()=>{},deleteAssignment:()=>{}};const[A,v]=n.useState(s.images||[]),[I,b]=n.useState(s.schedules||[]),[r,N]=n.useState(s.tour_services||s.tourServices||[]),[h,g]=n.useState(s.trip_assignments||s.tripAssignments||s.trip_assignments||[]),[w,f]=n.useState(s.tour_policies||s.tourPolicies||[]);return n.useEffect(()=>{v(s.images||[]),b(s.schedules||[]),N(s.tour_services||s.tour_services||[]),f(s.tour_policies||s.tour_policies||[]),g(s.trip_assignments||s.tripAssignments||s.trip_assignments||[])},[s]),{galleryImages:A,schedules:I,tourServices:r,tourPolicies:w,assignments:h,loading:d,refreshData:()=>{E.reload({only:["tour","template"],onStart:()=>c(!0),onFinish:()=>c(!1),preserveScroll:!0})},deleteImage:async(a,l)=>{c(!0);try{await u.delete(`/tours/${s.id}/images/${a}`),v(i=>i.filter(m=>m.id!==a)),o.success("Đã xóa ảnh thành công"),l&&l()}catch(i){console.error(i),o.error("Xóa ảnh thất bại")}finally{c(!1)}},deleteSchedule:async(a,l)=>{c(!0);try{await u.delete(`/tours/${s.id}/schedules/${a}`),b(i=>i.filter(m=>m.id!==a)),o.success("Đã xóa lịch trình"),l&&l()}catch(i){console.error(i),o.error("Xóa lịch trình thất bại")}finally{c(!1)}},deleteService:async(a,l)=>{c(!0);try{await u.delete(`/tours/${s.id}/tourservices/${a}`),N(i=>i.filter(m=>m.id!==a)),o.success("Đã xóa dịch vụ khỏi tour"),l&&l()}catch(i){console.error(i),o.error("Lỗi khi xóa dịch vụ")}finally{c(!1)}},deleteTour:a=>{E.delete(k.destroy(s.id).url,{onSuccess:()=>{o.success("Đã xóa tour thành công"),a&&a()},onError:()=>o.error("Xóa tour thất bại")})},deletePolicy:async(a,l)=>{c(!0);try{await u.delete(`/tours/${s.id}/tourpolicies/${a}`),f(i=>i.filter(m=>m.id!==a)),o.success("Đã xóa chính sách thành công"),l&&l()}catch(i){console.error(i),o.error("Lỗi khi xóa chính sách")}finally{c(!1)}},deleteAssignment:async(a,l)=>{c(!0);try{await u.delete(`/tours/${s.id}/assignments/${a}`),g(i=>i.filter(m=>m.id!==a)),o.success("Đã xóa hướng dẫn viên khỏi tour"),l&&l()}catch(i){console.error(i),o.error("Lỗi khi xóa hướng dẫn viên")}finally{c(!1)}}}};function Je({tour:s,template:d,categories:c,availableServices:A,availablePolicies:v,destinations:I,guides:b}){const r=d||s,h=(d?.instances||[]).sort((t,_)=>{const a=t.price_adult!==null,l=_.price_adult!==null;return a&&!l?-1:!a&&l?1:new Date(_.date_start).getTime()-new Date(t.date_start).getTime()});if(console.log("Tour data:",s),console.log("Template data:",d),console.log("TourData (final):",r),!r||!r.id)return e.jsxs(z,{breadcrumbs:[],children:[e.jsx(G,{title:"Lỗi"}),e.jsx("div",{className:"min-h-screen bg-gray-50 p-8",children:e.jsx("div",{className:"mx-auto max-w-6xl",children:e.jsxs("div",{className:"rounded-lg border border-red-200 bg-red-50 p-6",children:[e.jsx("h2",{className:"text-lg font-semibold text-red-800",children:"Không tìm thấy tour"}),e.jsx("p",{className:"mt-2 text-sm text-red-600",children:"Tour bạn đang tìm kiếm không tồn tại hoặc đã bị xóa."})]})})})]});const g=n.useMemo(()=>d&&d.trip_assignments?{...r,trip_assignments:d.trip_assignments}:r,[r,d]),{galleryImages:w,schedules:f,assignments:H,tourServices:T,tourPolicies:V}=ee(g),M=n.useMemo(()=>c.find(t=>t.id===r.category_id),[c,r.category_id]),B=n.useMemo(()=>[{title:"Danh Sách Tour",href:k.index().url},{title:`Chi tiết: ${r.title}`,href:r.id?k.show(r.id).url:"#"}],[r.id,r.title]);return e.jsxs(z,{breadcrumbs:B,children:[e.jsx(G,{title:`Chi tiết: ${r.title}`}),e.jsx("div",{className:"min-h-screen bg-gray-50 p-8",children:e.jsxs("div",{className:"mx-auto max-w-6xl",children:[e.jsx(W,{tour:r,categoryName:M?.title}),e.jsx("div",{className:"mt-6",children:e.jsxs(q,{defaultValue:"overview",className:"w-full",children:[e.jsxs(U,{className:"w-full justify-start overflow-x-auto flex-nowrap h-auto p-1 bg-white rounded-lg border",children:[e.jsx(x,{value:"overview",className:"flex-1 min-w-[100px] whitespace-nowrap",children:"Tổng quan"}),e.jsx(x,{value:"schedule",className:"flex-1 min-w-[100px] whitespace-nowrap",children:"Lịch trình"}),e.jsx(x,{value:"services",className:"flex-1 min-w-[150px] whitespace-nowrap",children:"Dịch vụ & Chính sách"}),e.jsx(x,{value:"departures",className:"flex-1 min-w-[120px] whitespace-nowrap",children:"Lịch khởi hành"}),e.jsx(x,{value:"guides",className:"flex-1 min-w-[120px] whitespace-nowrap",children:"Hướng dẫn viên"})]}),e.jsx(p,{value:"overview",className:"mt-6 space-y-6",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"md:col-span-2 space-y-6",children:[e.jsx(K,{tour:r,images:w}),e.jsxs(S,{children:[e.jsx(C,{children:e.jsx(L,{children:"Mô tả chi tiết"})}),e.jsx($,{children:e.jsx("div",{className:"prose max-w-none text-gray-700",children:r.description?e.jsx("div",{dangerouslySetInnerHTML:{__html:r.description}}):e.jsx("p",{className:"text-gray-500 italic",children:"Chưa có mô tả chi tiết cho tour này."})})})]})]}),e.jsx("div",{className:"space-y-6",children:e.jsx(J,{tour:r,instances:h})})]})}),e.jsx(p,{value:"schedule",className:"mt-6",children:e.jsx(Q,{schedules:f})}),e.jsxs(p,{value:"services",className:"mt-6 space-y-6",children:[e.jsx(Y,{tourServices:T}),e.jsx(O,{tourPolicies:V})]}),e.jsx(p,{value:"departures",className:"mt-6",children:e.jsx("div",{className:"space-y-6",children:h.length>0?e.jsxs(S,{children:[e.jsxs(C,{className:"flex flex-row items-center justify-between pb-2",children:[e.jsxs(L,{className:"flex items-center gap-2 text-base",children:[e.jsx(P,{className:"h-5 w-5 text-blue-600"})," Danh sách Chuyến Đi"]}),e.jsx(j,{href:`/tours/${r.id}/instances/create`,children:e.jsxs(y,{variant:"outline",size:"sm",className:"gap-1",children:[e.jsx(F,{className:"h-4 w-4"})," Tạo chuyến đi mới"]})})]}),e.jsx($,{children:e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:h.map(t=>e.jsxs("div",{className:"rounded-lg border p-4 hover:bg-gray-50 bg-white shadow-sm flex flex-col justify-between",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx(X,{variant:"secondary",className:`${t.status===0?"bg-red-100 text-red-800":t.status===1?"bg-yellow-100 text-yellow-800":t.status===2?"bg-blue-100 text-blue-800":"bg-green-100 text-green-800"}`,children:t.status===0?"Đã hủy":t.status===1?"Sắp có":t.status===2?"Đang diễn ra":"Đã hoàn thành"}),e.jsx(j,{href:`/tour-instances/${t.id}/edit`,children:e.jsx(y,{size:"icon",variant:"ghost",className:"h-8 w-8 text-gray-400 hover:text-blue-600",children:e.jsx(D,{className:"h-4 w-4"})})})]}),e.jsx("h3",{className:"font-semibold text-lg text-blue-700 mb-1",children:new Date(t.date_start).toLocaleDateString("vi-VN")}),e.jsxs("p",{className:"text-sm text-gray-500 mb-3",children:["đến ",new Date(t.date_end).toLocaleDateString("vi-VN")]}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"flex justify-between border-b pb-1",children:[e.jsx("span",{className:"text-gray-600",children:"Giá người lớn:"}),e.jsx("span",{className:"font-medium",children:t.price_adult?new Intl.NumberFormat("vi-VN",{style:"currency",currency:"VND"}).format(t.price_adult):"N/A"})]}),e.jsxs("div",{className:"flex justify-between border-b pb-1",children:[e.jsx("span",{className:"text-gray-600",children:"Trẻ em:"}),e.jsx("span",{className:"font-medium",children:t.price_children?new Intl.NumberFormat("vi-VN",{style:"currency",currency:"VND"}).format(t.price_children):"N/A"})]})]})]}),e.jsxs("div",{className:"mt-4 pt-3 border-t flex items-center justify-between text-sm",children:[e.jsxs("span",{className:"flex items-center gap-1 text-gray-600",children:[e.jsx(Z,{className:"h-4 w-4"}),"Chỗ: ",e.jsxs("span",{className:"font-medium text-gray-900",children:[t.booked_count," / ",t.limit||"∞"]})]}),e.jsx(j,{href:`/booking/create?tour_instance_id=${t.id}`,children:e.jsx(y,{size:"sm",variant:"default",className:"bg-blue-600 hover:bg-blue-700",children:"Đặt chỗ ngay"})})]})]},t.id))})})]}):e.jsxs(S,{children:[e.jsx(C,{children:e.jsxs(L,{className:"flex items-center gap-2 text-base",children:[e.jsx(P,{className:"h-5 w-5 text-blue-600"})," Chuyến Đi"]})}),e.jsxs($,{className:"text-center py-8",children:[e.jsx(P,{className:"h-12 w-12 mx-auto text-gray-300 mb-3"}),e.jsx("p",{className:"text-gray-500 mb-4",children:"Chưa có chuyến đi nào được tạo cho tour này."}),e.jsx(j,{href:`/tours/${r.id}/instances/create`,children:e.jsxs(y,{children:[e.jsx(F,{className:"mr-2 h-4 w-4"})," Tạo chuyến đi đầu tiên"]})})]})]})})}),e.jsx(p,{value:"guides",className:"mt-6",children:e.jsx(R,{assignments:H})})]})})]})})]})}export{Je as default};
