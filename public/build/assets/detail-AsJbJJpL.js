import{r as o,d as u,a as k,j as e,H as E,L as v}from"./app-CaSGj1uT.js";import{B as G}from"./badge-fjcL5lAh.js";import{B as p}from"./button-BZEXzofL.js";import{b as S,C,a as L,c as $}from"./card-B5yYBXn0.js";import{T as U,a as q,b as g,c as f}from"./tabs-BLO8y8qf.js";import{t as A}from"./index-7ujUmCNw.js";import{t as n}from"./index-D9FVAaNM.js";import{A as X}from"./app-layout-Cy2scFGy.js";import K from"./TourGallery-DQmCHPjS.js";import R from"./TourGuideList-D5xjN-FU.js";import W from"./TourHeader-CR-HFVvN.js";import J from"./TourInfoCards-j3Mq_eoY.js";import O from"./TourPolicyList-B3QoyP7S.js";import Q from"./TourScheduleList-DP-a8Iz3.js";import Y from"./TourServiceList-XCT063XW.js";import{C as P,U as Z}from"./users-BVM233CZ.js";import{P as F}from"./plus-Cuh-3za3.js";import{S as D}from"./square-pen-Cin-F8cH.js";import"./app-C1CjLIM7.js";import"./utils-D0Zg16Wk.js";import"./index-P0NC3ElT.js";import"./index-Dc8D3YAC.js";import"./index-B35KFXzL.js";import"./createLucideIcon-B2IF2C91.js";import"./index-CMWG4mbA.js";import"./x-BJwh83_V.js";import"./avatar-y1YlfNVC.js";import"./index-Dhq0cQs_.js";import"./index-D9s5CDJa.js";import"./app-logo-icon-2KxTv0kJ.js";import"./index-31lGrPGR.js";import"./index-gSLmiL6w.js";import"./index-DaohGxKX.js";import"./index-2FGh3n-F.js";import"./index-CGelz8kl.js";import"./file-text-xLwrV0oL.js";import"./trash-2-7ovCRB6M.js";import"./arrow-left-DWM__Iss.js";import"./pencil-CgkILQjS.js";import"./helperInfoItem-COrF5rHw.js";import"./dollar-sign-CtqSZOJi.js";import"./clock-BZi_k4Xa.js";import"./map-pin-ASbtl6oT.js";import"./eye-DB6MKcxJ.js";import"./shield-check-CniJqsHq.js";import"./separator-LLA5euI7.js";import"./package-B6_IJZBG.js";const ee=s=>{const[d,c]=o.useState(!1);if(!s)return{galleryImages:[],schedules:[],tourServices:[],assignments:[],tourPolicies:[],loading:!1,refreshData:()=>{},deleteService:()=>{},deleteImage:()=>{},deleteSchedule:()=>{},deleteTour:()=>{},deletePolicy:()=>{},deleteAssignment:()=>{}};const[I,N]=o.useState(s.images||[]),[H,b]=o.useState(s.schedules||[]),[t,w]=o.useState(s.tour_services||s.tourServices||[]),[x,j]=o.useState(s.trip_assignments||s.tripAssignments||s.trip_assignments||[]),[_,y]=o.useState(s.tour_policies||s.tourPolicies||[]);return o.useEffect(()=>{N(s.images||[]),b(s.schedules||[]),w(s.tour_services||s.tour_services||[]),y(s.tour_policies||s.tour_policies||[]),j(s.trip_assignments||s.tripAssignments||s.trip_assignments||[])},[s]),{galleryImages:I,schedules:H,tourServices:t,tourPolicies:_,assignments:x,loading:d,refreshData:()=>{k.reload({only:["tour","template"],onStart:()=>c(!0),onFinish:()=>c(!1),preserveScroll:!0})},deleteImage:async(a,l)=>{c(!0);try{await u.delete(`/tours/${s.id}/images/${a}`),N(i=>i.filter(m=>m.id!==a)),n.success("Đã xóa ảnh thành công"),l&&l()}catch(i){console.error(i),n.error("Xóa ảnh thất bại")}finally{c(!1)}},deleteSchedule:async(a,l)=>{c(!0);try{await u.delete(`/tours/${s.id}/schedules/${a}`),b(i=>i.filter(m=>m.id!==a)),n.success("Đã xóa lịch trình"),l&&l()}catch(i){console.error(i),n.error("Xóa lịch trình thất bại")}finally{c(!1)}},deleteService:async(a,l)=>{c(!0);try{await u.delete(`/tours/${s.id}/tourservices/${a}`),w(i=>i.filter(m=>m.id!==a)),n.success("Đã xóa dịch vụ khỏi tour"),l&&l()}catch(i){console.error(i),n.error("Lỗi khi xóa dịch vụ")}finally{c(!1)}},deleteTour:a=>{k.delete(A.destroy(s.id).url,{onSuccess:()=>{n.success("Đã xóa tour thành công"),a&&a()},onError:()=>n.error("Xóa tour thất bại")})},deletePolicy:async(a,l)=>{c(!0);try{await u.delete(`/tours/${s.id}/tourpolicies/${a}`),y(i=>i.filter(m=>m.id!==a)),n.success("Đã xóa chính sách thành công"),l&&l()}catch(i){console.error(i),n.error("Lỗi khi xóa chính sách")}finally{c(!1)}},deleteAssignment:async(a,l)=>{c(!0);try{await u.delete(`/tours/${s.id}/assignments/${a}`),j(i=>i.filter(m=>m.id!==a)),n.success("Đã xóa hướng dẫn viên khỏi tour"),l&&l()}catch(i){console.error(i),n.error("Lỗi khi xóa hướng dẫn viên")}finally{c(!1)}}}};function Je({tour:s,template:d,categories:c,availableServices:I,availablePolicies:N,destinations:H,guides:b}){const t=d||s,x=(d?.instances||[]).sort((r,h)=>{const a=r.price_adult!==null,l=h.price_adult!==null;return a&&!l?-1:!a&&l?1:new Date(h.date_start).getTime()-new Date(r.date_start).getTime()});if(console.log("Tour data:",s),console.log("Template data:",d),console.log("TourData (final):",t),!t||!t.id)return e.jsxs(X,{breadcrumbs:[],children:[e.jsx(E,{title:"Lỗi"}),e.jsx("div",{className:"min-h-screen bg-gray-50 p-8",children:e.jsx("div",{className:"mx-auto max-w-6xl",children:e.jsxs("div",{className:"rounded-lg border border-red-200 bg-red-50 p-6",children:[e.jsx("h2",{className:"text-lg font-semibold text-red-800",children:"Không tìm thấy tour"}),e.jsx("p",{className:"mt-2 text-sm text-red-600",children:"Tour bạn đang tìm kiếm không tồn tại hoặc đã bị xóa."})]})})})]});const j=o.useMemo(()=>d&&d.trip_assignments?{...t,trip_assignments:d.trip_assignments}:t,[t,d]),{galleryImages:_,schedules:y,assignments:T,tourServices:V,tourPolicies:B}=ee(j),M=o.useMemo(()=>c.find(r=>r.id===t.category_id),[c,t.category_id]),z=o.useMemo(()=>[{title:"Danh Sách Tour",href:A.index().url},{title:`Chi tiết: ${t.title}`,href:t.id?A.show(t.id).url:"#"}],[t.id,t.title]);return e.jsxs(X,{breadcrumbs:z,children:[e.jsx(E,{title:`Chi tiết: ${t.title}`}),e.jsx("div",{className:"min-h-screen bg-gray-50 p-8",children:e.jsxs("div",{className:"mx-auto max-w-6xl",children:[e.jsx(W,{tour:t,categoryName:M?.title}),e.jsx("div",{className:"mt-6",children:e.jsxs(U,{defaultValue:"overview",className:"w-full",children:[e.jsxs(q,{className:"w-full justify-start overflow-x-auto flex-nowrap h-auto p-1 bg-white rounded-lg border",children:[e.jsx(g,{value:"overview",className:"flex-1 min-w-[100px] whitespace-nowrap",children:"Tổng quan"}),e.jsx(g,{value:"schedule",className:"flex-1 min-w-[100px] whitespace-nowrap",children:"Lịch trình"}),e.jsx(g,{value:"services",className:"flex-1 min-w-[150px] whitespace-nowrap",children:"Dịch vụ & Chính sách"}),e.jsx(g,{value:"departures",className:"flex-1 min-w-[120px] whitespace-nowrap",children:"Lịch khởi hành"}),e.jsx(g,{value:"guides",className:"flex-1 min-w-[120px] whitespace-nowrap",children:"Hướng dẫn viên"})]}),e.jsx(f,{value:"overview",className:"mt-6 space-y-6",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"md:col-span-2 space-y-6",children:[e.jsx(K,{tour:t,images:_}),e.jsxs(S,{children:[e.jsx(C,{children:e.jsx(L,{children:"Mô tả chi tiết"})}),e.jsx($,{children:e.jsx("div",{className:"prose max-w-none text-gray-700",children:t.description?e.jsx("div",{dangerouslySetInnerHTML:{__html:t.description}}):e.jsx("p",{className:"text-gray-500 italic",children:"Chưa có mô tả chi tiết cho tour này."})})})]})]}),e.jsx("div",{className:"space-y-6",children:e.jsx(J,{tour:t,instances:x})})]})}),e.jsx(f,{value:"schedule",className:"mt-6",children:e.jsx(Q,{schedules:y})}),e.jsxs(f,{value:"services",className:"mt-6 space-y-6",children:[e.jsx(Y,{tourServices:V}),e.jsx(O,{tourPolicies:B})]}),e.jsx(f,{value:"departures",className:"mt-6",children:e.jsx("div",{className:"space-y-6",children:x.length>0?e.jsxs(S,{children:[e.jsxs(C,{className:"flex flex-row items-center justify-between pb-2",children:[e.jsxs(L,{className:"flex items-center gap-2 text-base",children:[e.jsx(P,{className:"h-5 w-5 text-blue-600"})," Danh sách Chuyến Đi"]}),e.jsx(v,{href:`/tours/${t.id}/instances/create`,children:e.jsxs(p,{variant:"outline",size:"sm",className:"gap-1",children:[e.jsx(F,{className:"h-4 w-4"})," Tạo chuyến đi mới"]})})]}),e.jsx($,{children:e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:x.map(r=>e.jsxs("div",{className:"rounded-lg border p-4 hover:bg-gray-50 bg-white shadow-sm flex flex-col justify-between",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx(G,{variant:"secondary",className:`${r.status===0?"bg-red-100 text-red-800":r.status===1?"bg-yellow-100 text-yellow-800":r.status===2?"bg-blue-100 text-blue-800":"bg-green-100 text-green-800"}`,children:r.status===0?"Đã hủy":r.status===1?"Sắp có":r.status===2?"Đang diễn ra":"Đã hoàn thành"}),e.jsx(v,{href:`/tour-instances/${r.id}/edit`,children:e.jsx(p,{size:"icon",variant:"ghost",className:"h-8 w-8 text-gray-400 hover:text-blue-600",children:e.jsx(D,{className:"h-4 w-4"})})})]}),e.jsx("h3",{className:"font-semibold text-lg text-blue-700 mb-1",children:new Date(r.date_start).toLocaleDateString("vi-VN")}),e.jsxs("p",{className:"text-sm text-gray-500 mb-3",children:["đến ",new Date(r.date_end).toLocaleDateString("vi-VN")]}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"flex justify-between border-b pb-1",children:[e.jsx("span",{className:"text-gray-600",children:"Giá người lớn:"}),e.jsx("span",{className:"font-medium",children:r.price_adult?new Intl.NumberFormat("vi-VN",{style:"currency",currency:"VND"}).format(r.price_adult):"N/A"})]}),e.jsxs("div",{className:"flex justify-between border-b pb-1",children:[e.jsx("span",{className:"text-gray-600",children:"Trẻ em:"}),e.jsx("span",{className:"font-medium",children:r.price_children?new Intl.NumberFormat("vi-VN",{style:"currency",currency:"VND"}).format(r.price_children):"N/A"})]})]}),r.assignments&&r.assignments.length>0&&e.jsxs("div",{className:"mb-3",children:[e.jsx("p",{className:"text-xs font-semibold text-gray-500 mb-1",children:"Hướng dẫn viên:"}),e.jsx("div",{className:"flex flex-wrap gap-1",children:r.assignments.map(h=>e.jsx(G,{variant:"secondary",className:"text-xs font-normal",children:h.user?.name||"Unknown"},h.id))})]})]}),e.jsxs("div",{className:"mt-4 pt-3 border-t space-y-3",children:[e.jsx("div",{className:"flex items-center justify-between text-sm",children:e.jsxs("span",{className:"flex items-center gap-1 text-gray-600",children:[e.jsx(Z,{className:"h-4 w-4"}),e.jsxs("span",{className:"font-medium text-gray-900",children:[r.booked_count," / ",r.limit||"∞"]})]})}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsx(v,{href:`/booking/create?tour_instance_id=${r.id}`,className:"w-full",children:e.jsx(p,{size:"sm",className:"w-full bg-blue-600 hover:bg-blue-700",children:"Đặt chỗ"})}),e.jsx(p,{size:"sm",variant:"outline",className:"w-full text-red-600 border-red-200 hover:bg-red-50",onClick:()=>{confirm("Bạn có chắc muốn xóa lịch khởi hành này?")&&k.visit(route("tour-instances.destroy",r.id),{method:"delete"})},children:"Xóa"})]})]})]},r.id))})})]}):e.jsxs(S,{children:[e.jsx(C,{children:e.jsxs(L,{className:"flex items-center gap-2 text-base",children:[e.jsx(P,{className:"h-5 w-5 text-blue-600"})," Chuyến Đi"]})}),e.jsxs($,{className:"text-center py-8",children:[e.jsx(P,{className:"h-12 w-12 mx-auto text-gray-300 mb-3"}),e.jsx("p",{className:"text-gray-500 mb-4",children:"Chưa có chuyến đi nào được tạo cho tour này."}),e.jsx(v,{href:`/tours/${t.id}/instances/create`,children:e.jsxs(p,{children:[e.jsx(F,{className:"mr-2 h-4 w-4"})," Tạo chuyến đi đầu tiên"]})})]})]})})}),e.jsx(f,{value:"guides",className:"mt-6",children:e.jsx(R,{assignments:T})})]})})]})})]})}export{Je as default};
