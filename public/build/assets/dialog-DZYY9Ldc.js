import{u as L,r as g,j as e}from"./app-U8YXLd1t.js";import{B as w}from"./button-BIK6FZZj.js";import{d as M,c as H,D as P,a as B}from"./dialog-4OB0kv9o.js";import{I as d}from"./input-DIDqrx5K.js";import{L as l}from"./label-BPy6BQ9z.js";import{d as v,S as _,a as f,b,c as h}from"./select-DSR3rMaI.js";import{T as G}from"./textarea-D7LKIosO.js";import{t as T}from"./index-7ujUmCNw.js";import{X as K}from"./x-DKlh0bgi.js";import{C as $}from"./cloud-upload-CmVK4J1t.js";import"./app-ClQ2typU.js";import"./utils-D0Zg16Wk.js";import"./index-Hv_yU9_w.js";import"./index-B35DBIvM.js";import"./index-DXf1X9xn.js";import"./createLucideIcon-CBVvH8xR.js";import"./index-DCB7DMTV.js";import"./index-CMWG4mbA.js";function de({open:x,onOpenChange:m,initialData:r,title:I,categories:k=[],destinations:R=[]}){const{data:i,setData:n,post:y,processing:N,errors:s,reset:p,clearErrors:V,setError:C}=L({category_id:"",destination_id:"",title:"",status:0,day:"",night:"",limit:"",date_start:"",thumbnail:null,description:"",short_description:"",price_adult:"",price_children:""}),[S,u]=g.useState(null),c=g.useRef(null);g.useEffect(()=>{x&&(V(),r?(n({category_id:r.category_id,destination_id:r.destination_id||"",title:r.title,status:r.status,day:r.day,night:r.night,limit:r.limit||"",date_start:r.date_start?r.date_start.split("T")[0]:"",thumbnail:null,description:r.description,short_description:r.short_description,price_adult:r.price_adult,price_children:r.price_children}),u(r.thumbnail)):(p(),u(null),c.current&&(c.current.value="")))},[r,x]);const q=t=>{const a=t.target.files?.[0];if(a){const j=URL.createObjectURL(a);u(j),n("thumbnail",a)}},E=()=>{u(null),n("thumbnail",null),c.current&&(c.current.value="")},o=(t,a)=>{a===""?n(t,""):n(t,Number(a))},U=t=>{t.preventDefault();const a=Number(i.day),j=Number(i.night);if(Math.abs(a-j)>1){const F="Số ngày và đêm chỉ được chênh lệch tối đa 1 (VD: 3N2Đ hoặc 2N3Đ).";C("day",F),C("night",F);return}r?(i._method="PUT",y(T.update(r.id).url,{onSuccess:()=>{m(!1),p()},forceFormData:!0})):y(T.store().url,{onSuccess:()=>{m(!1),p()},forceFormData:!0})};return e.jsx(M,{open:x,onOpenChange:m,children:e.jsxs(H,{className:"max-h-[90vh] max-w-2xl overflow-y-auto",children:[e.jsx(P,{children:e.jsx(B,{children:I})}),e.jsxs("form",{onSubmit:U,className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(l,{htmlFor:"category_id",children:"Danh mục"}),e.jsxs(v,{onValueChange:t=>n("category_id",Number(t)),value:i.category_id?String(i.category_id):void 0,children:[e.jsx(_,{children:e.jsx(f,{placeholder:"Chọn danh mục"})}),e.jsx(b,{children:k.map(t=>e.jsx(h,{value:String(t.id),children:t.title},t.id))})]}),s.category_id&&e.jsx("span",{className:"text-sm text-red-500",children:s.category_id})]}),e.jsxs("div",{children:[e.jsx(l,{htmlFor:"destination_id",children:"Địa điểm"}),e.jsxs(v,{onValueChange:t=>n("destination_id",Number(t)),value:i.destination_id?String(i.destination_id):void 0,children:[e.jsx(_,{children:e.jsx(f,{placeholder:"Chọn địa điểm"})}),e.jsx(b,{children:R.map(t=>e.jsx(h,{value:String(t.id),children:t.name},t.id))})]}),s.destination_id&&e.jsx("span",{className:"text-sm text-red-500",children:s.destination_id})]}),e.jsxs("div",{className:"col-span-2",children:[e.jsx(l,{htmlFor:"title",children:"Tên Tour"}),e.jsx(d,{id:"title",value:i.title,onChange:t=>n("title",t.target.value),required:!0}),s.title&&e.jsx("span",{className:"text-sm text-red-500",children:s.title})]}),e.jsxs("div",{children:[e.jsx(l,{htmlFor:"status",children:"Trạng thái"}),e.jsxs(v,{onValueChange:t=>n("status",Number(t)),value:String(i.status),children:[e.jsx(_,{children:e.jsx(f,{placeholder:"Trạng thái"})}),e.jsxs(b,{children:[e.jsx(h,{value:"0",children:"Hoạt động"}),e.jsx(h,{value:"1",children:"Không hoạt động"}),e.jsx(h,{value:"2",children:"Sắp có"})]})]}),s.status&&e.jsx("span",{className:"text-sm text-red-500",children:s.status})]}),e.jsxs("div",{children:[e.jsx(l,{htmlFor:"date_start",children:"Ngày khởi hành"}),e.jsx(d,{id:"date_start",type:"date",value:i.date_start,onChange:t=>n("date_start",t.target.value),required:!0}),s.date_start&&e.jsx("span",{className:"text-sm text-red-500",children:s.date_start})]}),e.jsxs("div",{className:"col-span-2 grid grid-cols-3 gap-2",children:[e.jsxs("div",{children:[e.jsx(l,{htmlFor:"day",children:"Số ngày"}),e.jsx(d,{id:"day",type:"number",value:i.day,onChange:t=>o("day",t.target.value),required:!0,min:"1"}),s.day&&e.jsx("span",{className:"text-sm text-red-500",children:s.day})]}),e.jsxs("div",{children:[e.jsx(l,{htmlFor:"night",children:"Số đêm"}),e.jsx(d,{id:"night",type:"number",value:i.night,onChange:t=>o("night",t.target.value),required:!0,min:"0"}),s.night&&e.jsx("span",{className:"text-sm text-red-500",children:s.night})]}),e.jsxs("div",{children:[e.jsx(l,{htmlFor:"limit",children:"Max Khách"}),e.jsx(d,{id:"limit",type:"number",placeholder:"VD: 20",value:i.limit,onChange:t=>o("limit",t.target.value),min:"1"}),s.limit&&e.jsx("span",{className:"text-sm text-red-500",children:s.limit})]})]}),e.jsxs("div",{className:"col-span-2",children:[e.jsx(l,{children:"Hình ảnh (Thumbnail)"}),e.jsxs("div",{className:"mt-2",children:[S?e.jsxs("div",{className:"relative h-48 w-full overflow-hidden rounded-md border border-gray-200",children:[e.jsx("img",{src:S,alt:"Thumbnail preview",className:"h-full w-full object-cover"}),e.jsx("button",{type:"button",onClick:E,className:"absolute top-2 right-2 rounded-full bg-red-500 p-1 text-white shadow-sm transition-colors hover:bg-red-600",children:e.jsx(K,{className:"h-4 w-4"})})]}):e.jsx("div",{className:"flex h-48 w-full cursor-pointer flex-col items-center justify-center rounded-md border-2 border-dashed border-gray-300 bg-gray-50 transition-colors hover:bg-gray-100",onClick:()=>c.current?.click(),children:e.jsxs("div",{className:"flex flex-col items-center justify-center pt-5 pb-6",children:[e.jsx($,{className:"mb-2 h-8 w-8 text-gray-400"}),e.jsx("p",{className:"mb-2 text-sm text-gray-500",children:e.jsx("span",{className:"font-semibold",children:"Click to upload"})})]})}),e.jsx("input",{type:"file",ref:c,className:"hidden",accept:"image/*",onChange:q}),s.thumbnail&&e.jsx("span",{className:"text-sm text-red-500",children:s.thumbnail})]})]}),e.jsxs("div",{children:[e.jsx(l,{htmlFor:"price_adult",children:"Giá người lớn ($)"}),e.jsx(d,{id:"price_adult",type:"number",step:"0.01",value:i.price_adult,onChange:t=>o("price_adult",t.target.value),min:"0",required:!0}),s.price_adult&&e.jsx("span",{className:"text-sm text-red-500",children:s.price_adult})]}),e.jsxs("div",{children:[e.jsx(l,{htmlFor:"price_children",children:"Giá trẻ em ($)"}),e.jsx(d,{id:"price_children",type:"number",step:"0.01",value:i.price_children,onChange:t=>o("price_children",t.target.value),min:"0"}),s.price_children&&e.jsx("span",{className:"text-sm text-red-500",children:s.price_children})]}),e.jsxs("div",{className:"col-span-2",children:[e.jsx(l,{htmlFor:"short_description",children:"Mô tả ngắn"}),e.jsx(d,{id:"short_description",value:i.short_description,onChange:t=>n("short_description",t.target.value)}),s.short_description&&e.jsx("span",{className:"text-sm text-red-500",children:s.short_description})]}),e.jsxs("div",{className:"col-span-2",children:[e.jsx(l,{htmlFor:"description",children:"Mô tả chi tiết"}),e.jsx(G,{id:"description",value:i.description,onChange:t=>n("description",t.target.value),rows:4}),s.description&&e.jsx("span",{className:"text-sm text-red-500",children:s.description})]})]}),e.jsxs("div",{className:"mt-4 flex justify-end gap-2",children:[e.jsx(w,{type:"button",variant:"outline",onClick:()=>m(!1),children:"Cancel"}),e.jsxs(w,{type:"submit",disabled:N,children:[N?"Saving...":r?"Update":"Create"," ","Tour"]})]})]})]})})}export{de as TourFormDialog};
