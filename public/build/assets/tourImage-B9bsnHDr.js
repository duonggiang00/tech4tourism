import{c as Q,r as F,u as Y,j as t}from"./app-CQY01_Hl.js";import{B as K}from"./button-BluykqL-.js";import{D as Z,a as ee,c as te,d as se}from"./dialog-BkFPLtOE.js";import{L as re}from"./label-EGOmbW92.js";import{t as H}from"./index-Du1opkJh.js";import{X as le}from"./x-C5aSEyQM.js";import{c as ae}from"./createLucideIcon-DRgLANJZ.js";import{C as ie}from"./cloud-upload-BBFD_HwX.js";import"./app-CEC-CZWY.js";import"./utils-D0Zg16Wk.js";import"./index-BZBSjhWP.js";import"./index-Cx_4zReh.js";/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ne=[["path",{d:"M16 5h6",key:"1vod17"}],["path",{d:"M19 2v6",key:"4bpg5p"}],["path",{d:"M21 11.5V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h7.5",key:"1ue2ih"}],["path",{d:"m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21",key:"1xmnt7"}],["circle",{cx:"9",cy:"9",r:"2",key:"af1f0g"}]],oe=ae("ImagePlus",ne);function Ne(j){const e=Q.c(56),{open:a,onOpenChange:i,tourId:M,onSuccess:v}=j,c=F.useRef(null);let y;e[0]===Symbol.for("react.memo_cache_sentinel")?(y=[],e[0]=y):y=e[0];const[s,O]=F.useState(y);let w;e[1]===Symbol.for("react.memo_cache_sentinel")?(w={images:[]},e[1]=w):w=e[1];const{data:r,setData:m,post:V,processing:q,errors:N,reset:$,clearErrors:B}=Y(w);let k,C;e[2]!==s?(k=()=>()=>{s.forEach(me)},C=[s],e[2]=s,e[3]=k,e[4]=C):(k=e[3],C=e[4]),F.useEffect(k,C);let S;e[5]!==B||e[6]!==a||e[7]!==$?(S=()=>{a||($(),O([]),B(),c.current&&(c.current.value=""))},e[5]=B,e[6]=a,e[7]=$,e[8]=S):S=e[8];let _;e[9]!==a?(_=[a],e[9]=a,e[10]=_):_=e[10],F.useEffect(S,_);let L;e[11]!==r.images||e[12]!==s||e[13]!==m?(L=l=>{if(l.target.files&&l.target.files.length>0){const n=Array.from(l.target.files),o=[],J=[];if(n.forEach(T=>{T.type.startsWith("image/")&&(T.size>5242880||(o.push(T),J.push(URL.createObjectURL(T))))}),o.length===0){H.error("Vui lòng chọn file ảnh hợp lệ và nhỏ hơn 5MB");return}m("images",[...r.images,...o]),O([...s,...J]),c.current&&(c.current.value="")}},e[11]=r.images,e[12]=s,e[13]=m,e[14]=L):L=e[14];const z=L;let R;e[15]!==r.images||e[16]!==s||e[17]!==m?(R=l=>{const n=[...r.images],o=[...s];URL.revokeObjectURL(o[l]),n.splice(l,1),o.splice(l,1),m("images",n),O(o)},e[15]=r.images,e[16]=s,e[17]=m,e[18]=R):R=e[18];const A=R;let D;e[19]!==r.images.length||e[20]!==i||e[21]!==v||e[22]!==V||e[23]!==M?(D=l=>{if(l.preventDefault(),r.images.length===0){H.error("Vui lòng chọn ít nhất một hình ảnh.");return}V(`/tours/${M}/images`,{forceFormData:!0,preserveScroll:!0,onSuccess:()=>{i(!1),H.success("Thêm hình ảnh thành công!"),v&&v()},onError:ce})},e[19]=r.images.length,e[20]=i,e[21]=v,e[22]=V,e[23]=M,e[24]=D):D=e[24];const G=D;let E;e[25]===Symbol.for("react.memo_cache_sentinel")?(E=t.jsx(Z,{children:t.jsxs(ee,{className:"flex items-center gap-2",children:[t.jsx(oe,{className:"h-5 w-5 text-blue-600"}),"Thêm hình ảnh Tour (Nhiều ảnh)"]})}),e[25]=E):E=e[25];let I;e[26]===Symbol.for("react.memo_cache_sentinel")?(I=t.jsxs(re,{children:["Hình ảnh ",t.jsx("span",{className:"text-red-500",children:"*"})]}),e[26]=I):I=e[26];let U;e[27]===Symbol.for("react.memo_cache_sentinel")?(U=t.jsxs("div",{className:"mt-2 flex h-32 w-full cursor-pointer flex-col items-center justify-center rounded-md border-2 border-dashed border-gray-300 bg-gray-50 transition-colors hover:bg-gray-100",onClick:()=>c.current?.click(),children:[t.jsx(ie,{className:"mb-2 h-8 w-8 text-gray-400"}),t.jsx("p",{className:"text-sm font-semibold text-gray-500",children:"Click để chọn nhiều ảnh"}),t.jsx("p",{className:"text-xs text-gray-400",children:"(Giữ Ctrl/Shift để chọn nhiều file)"})]}),e[27]=U):U=e[27];let h;e[28]!==z?(h=t.jsx("input",{type:"file",multiple:!0,ref:c,className:"hidden",accept:"image/*",onChange:z}),e[28]=z,e[29]=h):h=e[29];let f;e[30]!==N.images?(f=N.images&&t.jsx("span",{className:"mt-1 block text-sm text-red-500",children:N.images}),e[30]=N.images,e[31]=f):f=e[31];let g;e[32]!==h||e[33]!==f?(g=t.jsxs("div",{children:[I,U,h,f]}),e[32]=h,e[33]=f,e[34]=g):g=e[34];let u;e[35]!==r.images||e[36]!==A||e[37]!==s?(u=s.length>0&&t.jsx("div",{className:"mt-4 grid grid-cols-2 gap-4 sm:grid-cols-3",children:s.map((l,n)=>t.jsxs("div",{className:"group relative aspect-video overflow-hidden rounded-md border",children:[t.jsx("img",{src:l,alt:`Preview ${n}`,className:"h-full w-full object-cover"}),t.jsx("button",{type:"button",onClick:()=>A(n),className:"absolute top-1 right-1 rounded-full bg-red-500 p-1 text-white opacity-90 shadow-sm transition-all hover:bg-red-600",children:t.jsx(le,{className:"h-3 w-3"})}),t.jsx("div",{className:"absolute right-0 bottom-0 left-0 truncate bg-black/50 px-2 py-1 text-[10px] text-white",children:r.images[n]?.name})]},n))}),e[35]=r.images,e[36]=A,e[37]=s,e[38]=u):u=e[38];let d;e[39]!==i?(d=t.jsx(K,{type:"button",variant:"outline",onClick:()=>i(!1),children:"Hủy"}),e[39]=i,e[40]=d):d=e[40];const W=q||r.images.length===0,X=q?"Đang tải lên...":`Lưu ${r.images.length} hình ảnh`;let p;e[41]!==W||e[42]!==X?(p=t.jsx(K,{type:"submit",disabled:W,children:X}),e[41]=W,e[42]=X,e[43]=p):p=e[43];let x;e[44]!==d||e[45]!==p?(x=t.jsxs("div",{className:"mt-4 flex justify-end gap-2 border-t pt-2",children:[d,p]}),e[44]=d,e[45]=p,e[46]=x):x=e[46];let b;e[47]!==G||e[48]!==g||e[49]!==u||e[50]!==x?(b=t.jsxs(te,{className:"max-h-[90vh] max-w-2xl overflow-y-auto",children:[E,t.jsxs("form",{onSubmit:G,className:"space-y-4",children:[g,u,x]})]}),e[47]=G,e[48]=g,e[49]=u,e[50]=x,e[51]=b):b=e[51];let P;return e[52]!==i||e[53]!==a||e[54]!==b?(P=t.jsx(se,{open:a,onOpenChange:i,children:b}),e[52]=i,e[53]=a,e[54]=b,e[55]=P):P=e[55],P}function ce(j){console.error("Upload error:",j),H.error("Có lỗi xảy ra khi tải ảnh lên.")}function me(j){return URL.revokeObjectURL(j)}export{Ne as TourImageDialog};
