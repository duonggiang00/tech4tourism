import{r as d,j as e,d as y}from"./app-CQY01_Hl.js";import{B as C}from"./button-BluykqL-.js";import{C as j}from"./checkbox-DkHIgEri.js";import{d as w,c as F,D as V,a as B,e as E,b as $}from"./dialog-BkFPLtOE.js";import{I as _}from"./input-Cr4PK9yE.js";import{d as M,S as L,a as K,b as q,c as H}from"./select-BC9YTAFF.js";import{T as I}from"./textarea-D_VMQaJc.js";import{t as o}from"./index-Du1opkJh.js";import"./app-CEC-CZWY.js";import"./utils-D0Zg16Wk.js";import"./index-BZBSjhWP.js";import"./index-Cx_4zReh.js";import"./index-B4_eF53t.js";import"./createLucideIcon-DRgLANJZ.js";import"./index-DK901XDU.js";import"./x-C5aSEyQM.js";function se({open:m,onOpenChange:h,tourId:b,schedule:s,onSuccess:T,existingSchedules:c=[],tour:N,allDestinations:x=[]}){const[p,v]=d.useState(!1),g=d.useMemo(()=>{const t=x.find(a=>a.id===N.destination_id);return t?x.filter(a=>a.id_provinces===t.id_provinces):[]},[N.destination_id,x]),[n,r]=d.useState({name:"",description:"",destination_id:"",date:1,breakfast:!1,lunch:!0,dinner:!0}),[i,u]=d.useState({});d.useEffect(()=>{if(m)if(u({}),s)r({name:s.name,description:s.description||"",destination_id:s.destination_id?String(s.destination_id):"",date:s.date,breakfast:!!s.breakfast,lunch:!!s.lunch,dinner:!!s.dinner});else{const t=c.length>0?Math.max(...c.map(a=>a.date)):0;r({name:"",description:"",destination_id:"",date:t+1,breakfast:!1,lunch:!0,dinner:!0})}},[s,m,c]);const D=()=>{const t={};let a=!0;n.name.trim()||(t.name="Tên hoạt động không được để trống.",a=!1),n.destination_id||(t.destination_id="Vui lòng chọn địa điểm.",a=!1);const l=Number(n.date);return n.date===""||l<1?(t.date="Ngày phải là số nguyên lớn hơn 0.",a=!1):c.some(k=>s&&k.id===s.id?!1:k.date===l)&&(t.date=`Ngày thứ ${l} đã tồn tại trong lịch trình.`,a=!1),u(t),a},f=t=>{i[t]&&u(a=>({...a,[t]:void 0}))},S=async()=>{if(!D()){o.error("Vui lòng kiểm tra lại thông tin nhập vào.");return}v(!0);try{s?(await y.put(`/tours/${b}/schedules/${s.id}`,n),o.success("Cập nhật lịch trình thành công!")):(await y.post(`/tours/${b}/schedules`,n),o.success("Thêm lịch trình mới thành công!")),T?.(),h(!1)}catch(t){console.error("Failed to save schedule",t);const a=t.response?.data?.message||"Không thể lưu lịch trình! Vui lòng thử lại.";o.error(a)}finally{v(!1)}};return e.jsx(w,{open:m,onOpenChange:h,children:e.jsxs(F,{className:"max-w-lg",children:[e.jsxs(V,{children:[e.jsx(B,{children:s?"Chỉnh sửa lịch trình":"Thêm lịch trình mới"}),e.jsx(E,{children:s?"Cập nhật thông tin chi tiết cho hoạt động trong ngày này.":"Điền thông tin chi tiết để tạo ra một lịch trình mới cho tour."})]}),e.jsxs("div",{className:"mt-3 space-y-4",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsxs("label",{className:"text-sm font-medium",children:["Ngày thứ mấy ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx(_,{type:"number",min:1,value:n.date,onChange:t=>{const a=t.target.value;r({...n,date:a===""?"":Number(a)}),f("date")},className:i.date?"border-red-500 focus-visible:ring-red-500":""}),i.date&&e.jsx("span",{className:"text-xs text-red-500",children:i.date})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsxs("label",{className:"text-sm font-medium",children:["Tên hoạt động"," ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx(_,{value:n.name,onChange:t=>{r({...n,name:t.target.value}),f("name")},placeholder:"Ví dụ: Tham quan chợ Đà Lạt",className:i.name?"border-red-500 focus-visible:ring-red-500":""}),i.name&&e.jsx("span",{className:"text-xs text-red-500",children:i.name})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsxs("label",{className:"text-sm font-medium",children:["Địa điểm (Cùng tỉnh)"," ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs(M,{value:n.destination_id,onValueChange:t=>{const a=g.find(l=>String(l.id)===t);r({...n,destination_id:t,name:a?`Tham quan ${a.name}`:n.name,description:a?a.description||`Khám phá ${a.name}`:n.description}),f("destination_id")},children:[e.jsx(L,{className:i.destination_id?"border-red-500":"",children:e.jsx(K,{placeholder:"Chọn địa điểm..."})}),e.jsx(q,{children:g.length>0?g.map(t=>e.jsx(H,{value:String(t.id),children:t.name},t.id)):e.jsx("div",{className:"p-2 text-center text-sm text-gray-500",children:"Không tìm thấy địa điểm khác cùng tỉnh."})})]}),i.destination_id&&e.jsx("span",{className:"text-xs text-red-500",children:i.destination_id})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("label",{className:"text-sm font-medium",children:"Mô tả chi tiết"}),e.jsx(I,{rows:4,value:n.description,onChange:t=>r({...n,description:t.target.value}),placeholder:"Mô tả các hoạt động cụ thể..."})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"Bữa ăn bao gồm"}),e.jsxs("div",{className:"flex gap-6",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(j,{id:"chk-breakfast",checked:n.breakfast,onCheckedChange:t=>r({...n,breakfast:!!t})}),e.jsx("label",{htmlFor:"chk-breakfast",className:"text-sm leading-none font-medium peer-disabled:cursor-not-allowed peer-disabled:opacity-70",children:"Sáng"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(j,{id:"chk-lunch",checked:n.lunch,onCheckedChange:t=>r({...n,lunch:!!t})}),e.jsx("label",{htmlFor:"chk-lunch",className:"text-sm leading-none font-medium peer-disabled:cursor-not-allowed peer-disabled:opacity-70",children:"Trưa"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(j,{id:"chk-dinner",checked:n.dinner,onCheckedChange:t=>r({...n,dinner:!!t})}),e.jsx("label",{htmlFor:"chk-dinner",className:"text-sm leading-none font-medium peer-disabled:cursor-not-allowed peer-disabled:opacity-70",children:"Tối"})]})]})]})]}),e.jsxs($,{children:[e.jsx(C,{variant:"outline",onClick:()=>h(!1),disabled:p,children:"Hủy"}),e.jsx(C,{onClick:S,disabled:p,children:p?"Đang lưu...":s?"Lưu thay đổi":"Thêm lịch trình"})]})]})})}export{se as FormTourScheduleDialog};
