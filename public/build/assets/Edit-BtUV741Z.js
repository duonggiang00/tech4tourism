import{c as xt,r as pt,u as yt,j as t,H as Nt}from"./app-Bzh0QcV-.js";import{B as Ve}from"./button-DLyenbHO.js";import{C as nt,a as ct,c as dt,b as ot}from"./card-DwG3PsBo.js";import{C as bt}from"./checkbox-CbbR_BTG.js";import{I as mt}from"./input-BI3Hn33c.js";import{L as ke}from"./label-CaT48Pgd.js";import{d as vt,S as St,a as Ct,b as wt,c as Je}from"./select-BE8zau-p.js";import{A as Tt}from"./app-layout-CMbpVfDp.js";import{t as ht}from"./index-7ujUmCNw.js";import{t as _t}from"./index-rXl9eqvF.js";import{f as ft,C as kt,v as Dt}from"./vi-vDRzmdPg.js";import{P as $t,a as Vt,b as Et}from"./popover-DvnMj0Ab.js";import{c as Ft}from"./utils-D0Zg16Wk.js";import{A as Ht}from"./arrow-left-DcITzwxY.js";import{T as Lt}from"./trash-2-BzQ-ycRS.js";import{C as Mt,U as It}from"./users-C6EN8SYz.js";import{C as Pt}from"./clock-Be8x_k56.js";import"./app-AjfTabGW.js";import"./index-Cs37kpNU.js";import"./index-DXbMLhRD.js";import"./index-BksToH6P.js";import"./createLucideIcon-Qg7y1Ni9.js";import"./index-3aTD3_kd.js";import"./x-Cc7sq3My.js";import"./avatar-DMx0EJxa.js";import"./index-Dhq0cQs_.js";import"./index-CMWG4mbA.js";import"./index-D9s5CDJa.js";import"./app-logo-icon-Cbb-6XH_.js";import"./index-31lGrPGR.js";import"./index-gSLmiL6w.js";import"./index-DaohGxKX.js";import"./index-2FGh3n-F.js";import"./index-CGelz8kl.js";import"./file-text-B2N7Qcbe.js";import"./badge-GiRAufZZ.js";const ut=w=>{const e=xt.c(12),{value:l,onChange:a,placeholder:f,id:C}=w,[u,d]=pt.useState(!1);let T;e[0]!==u||e[1]!==l?(T=u?l:l?Number(l).toLocaleString("vi-VN"):"",e[0]=u,e[1]=l,e[2]=T):T=e[2];const De=T;let c;e[3]!==a?(c=k=>{const s=k.target.value.replace(/\D/g,"");a(s)},e[3]=a,e[4]=c):c=e[4];let o,m;e[5]===Symbol.for("react.memo_cache_sentinel")?(o=()=>d(!0),m=()=>d(!1),e[5]=o,e[6]=m):(o=e[5],m=e[6]);let h;return e[7]!==De||e[8]!==C||e[9]!==f||e[10]!==c?(h=t.jsx(mt,{id:C,type:"text",value:De,onChange:c,onFocus:o,onBlur:m,placeholder:f}),e[7]=De,e[8]=C,e[9]=f,e[10]=c,e[11]=h):h=e[11],h};function Cs(w){const e=xt.c(219),{instance:l,template:a,guides:f,currentGuideIds:C}=w;let u;e[0]!==l.date_start?(u=()=>{if(l.date_start){const i=new Date(l.date_start),me=String(i.getHours()).padStart(2,"0"),he=String(i.getMinutes()).padStart(2,"0");return`${me}:${he}`}return"08:00"},e[0]=l.date_start,e[1]=u):u=e[1];const[d,T]=pt.useState(u),De=l.date_start;let c;e[2]!==l.limit?(c=l.limit?.toString()||"",e[2]=l.limit,e[3]=c):c=e[3];let o;e[4]!==l.price_adult?(o=l.price_adult?.toString()||"",e[4]=l.price_adult,e[5]=o):o=e[5];let m;e[6]!==l.price_children?(m=l.price_children?.toString()||"",e[6]=l.price_children,e[7]=m):m=e[7];let h;e[8]!==l.status?(h=l.status.toString(),e[8]=l.status,e[9]=h):h=e[9];let k;e[10]!==C||e[11]!==l.date_start||e[12]!==c||e[13]!==o||e[14]!==m||e[15]!==h?(k={date_start:De,limit:c,price_adult:o,price_children:m,status:h,guide_ids:C},e[10]=C,e[11]=l.date_start,e[12]=c,e[13]=o,e[14]=m,e[15]=h,e[16]=k):k=e[16];const{data:s,setData:r,put:We,delete:Ze,processing:Ee,errors:n}=yt(k);let Fe;e[17]!==l.id||e[18]!==We?(Fe=i=>{i.preventDefault(),We(`/tour-instances/${l.id}`,{onError:Kt})},e[17]=l.id,e[18]=We,e[19]=Fe):Fe=e[19];const et=Fe;let He;e[20]!==Ze||e[21]!==l.id?(He=()=>{confirm("Bạn có chắc chắn muốn xóa chuyến đi này không? Hành động này không thể hoàn tác.")&&Ze(`/tour-instances/${l.id}`,{onError:Gt})},e[20]=Ze,e[21]=l.id,e[22]=He):He=e[22];const $e=He;let Le;e[23]!==s.guide_ids||e[24]!==r?(Le=i=>{r("guide_ids",s.guide_ids.includes(i)?s.guide_ids.filter(me=>me!==i):[...s.guide_ids,i])},e[23]=s.guide_ids,e[24]=r,e[25]=Le):Le=e[25];const tt=Le;let D,$,V,E,x,p,_,g,F,H,j,L,M,y,I,N,b,P,v,S;if(e[26]!==s.date_start||e[27]!==n.date_start||e[28]!==$e||e[29]!==et||e[30]!==l.id||e[31]!==r||e[32]!==a.day||e[33]!==a.id||e[34]!==a.night||e[35]!==a.title||e[36]!==d){const i=s.date_start?new Date(s.date_start):null,me=i&&!isNaN(i.getTime())?new Date(i.getTime()+(a.day-1)*24*60*60*1e3).toISOString().split("T")[0]:"";V=Tt;let he;e[57]===Symbol.for("react.memo_cache_sentinel")?(he={title:"Danh sách Tour",href:ht.index().url},e[57]=he):he=e[57];const gt=a.title;let fe;e[58]!==a.id?(fe=ht.show(a.id),e[58]=a.id,e[59]=fe):fe=e[59];let ue;e[60]!==fe.url||e[61]!==a.title?(ue={title:gt,href:fe.url},e[60]=fe.url,e[61]=a.title,e[62]=ue):ue=e[62];const lt=`Chỉnh sửa chuyến đi #${l.id}`;let xe;e[63]!==lt?(xe={title:lt,href:"#"},e[63]=lt,e[64]=xe):xe=e[64],e[65]!==ue||e[66]!==xe?(v=[he,ue,xe],e[65]=ue,e[66]=xe,e[67]=v):v=e[67];const it=`Chỉnh sửa chuyến đi: ${a.title}`;e[68]!==it?(S=t.jsx(Nt,{title:it}),e[68]=it,e[69]=S):S=e[69],P="min-h-screen bg-gray-50/50 py-8",I="mx-auto max-w-4xl px-4";let Oe;e[70]===Symbol.for("react.memo_cache_sentinel")?(Oe=t.jsxs(Ve,{variant:"ghost",onClick:Bt,className:"pl-0 hover:bg-transparent hover:text-blue-600",children:[t.jsx(Ht,{className:"mr-2 h-4 w-4"}),"Quay lại"]}),e[70]=Oe):Oe=e[70];let Qe;e[71]===Symbol.for("react.memo_cache_sentinel")?(Qe=t.jsx(Lt,{className:"mr-2 h-4 w-4"}),e[71]=Qe):Qe=e[71],e[72]!==$e?(N=t.jsxs("div",{className:"mb-6 flex items-center justify-between",children:[Oe,t.jsx("div",{className:"flex gap-2",children:t.jsxs(Ve,{type:"button",variant:"destructive",onClick:$e,children:[Qe," Xóa Chuyến Đi"]})})]}),e[72]=$e,e[73]=N):N=e[73],e[74]!==l.id?(b=t.jsxs("h1",{className:"mb-6 text-2xl font-bold text-gray-800",children:["Chỉnh sửa Chuyến Đi #",l.id]}),e[74]=l.id,e[75]=b):b=e[75],L=et,M="space-y-6";let pe;e[76]!==a.title?(pe=t.jsx(nt,{children:t.jsxs(ct,{className:"text-blue-700",children:["Tour Template: ",a.title]})}),e[76]=a.title,e[77]=pe):pe=e[77];let Xe;e[78]===Symbol.for("react.memo_cache_sentinel")?(Xe=t.jsx("span",{className:"font-medium text-gray-600",children:"Thời gian:"}),e[78]=Xe):Xe=e[78];let _e;e[79]!==a.day||e[80]!==a.night?(_e=t.jsx(dt,{children:t.jsx("div",{className:"grid grid-cols-2 gap-4 text-sm",children:t.jsxs("div",{children:[Xe," ",a.day," ngày ",a.night," đêm"]})})}),e[79]=a.day,e[80]=a.night,e[81]=_e):_e=e[81],e[82]!==pe||e[83]!==_e?(y=t.jsxs(ot,{className:"border-blue-100 bg-blue-50/50",children:[pe,_e]}),e[82]=pe,e[83]=_e,e[84]=y):y=e[84],$=ot,e[85]===Symbol.for("react.memo_cache_sentinel")?(j=t.jsx(nt,{children:t.jsx(ct,{children:"Thông tin Chuyến Đi"})}),e[85]=j):j=e[85],D=dt,H="space-y-6",E="space-y-2",e[86]===Symbol.for("react.memo_cache_sentinel")?(x=t.jsxs(ke,{htmlFor:"date_start",children:["Ngày khởi hành"," ",t.jsx("span",{className:"text-red-500",children:"*"})]}),e[86]=x):x=e[86];const at=!s.date_start&&"text-muted-foreground";let ge;e[87]!==at?(ge=Ft("w-full justify-start text-left font-normal",at),e[87]=at,e[88]=ge):ge=e[88];let Ye;e[89]===Symbol.for("react.memo_cache_sentinel")?(Ye=t.jsx(Mt,{className:"mr-2 h-4 w-4"}),e[89]=Ye):Ye=e[89];let je;e[90]!==s.date_start?(je=s.date_start&&!isNaN(new Date(s.date_start).getTime())?ft(new Date(s.date_start),"dd/MM/yyyy"):t.jsx("span",{children:"Chọn ngày"}),e[90]=s.date_start,e[91]=je):je=e[91];let ye;e[92]!==ge||e[93]!==je?(ye=t.jsx($t,{asChild:!0,children:t.jsxs(Ve,{variant:"outline",className:ge,children:[Ye,je]})}),e[92]=ge,e[93]=je,e[94]=ye):ye=e[94];let Ne;e[95]!==s.date_start?(Ne=s.date_start?new Date(s.date_start):void 0,e[95]=s.date_start,e[96]=Ne):Ne=e[96];let be;e[97]!==r||e[98]!==d?(be=Te=>{if(Te){const ze=Te.getFullYear(),rt=String(Te.getMonth()+1).padStart(2,"0"),jt=String(Te.getDate()).padStart(2,"0");r("date_start",`${ze}-${rt}-${jt} ${d}`)}else r("date_start","")},e[97]=r,e[98]=d,e[99]=be):be=e[99];let ve;e[100]!==Ne||e[101]!==be?(ve=t.jsx(Vt,{className:"w-auto p-0",align:"start",children:t.jsx(kt,{mode:"single",selected:Ne,onSelect:be,initialFocus:!0})}),e[100]=Ne,e[101]=be,e[102]=ve):ve=e[102];let Se;e[103]!==ye||e[104]!==ve?(Se=t.jsx("div",{className:"flex-1",children:t.jsxs(Et,{children:[ye,ve]})}),e[103]=ye,e[104]=ve,e[105]=Se):Se=e[105];let qe;e[106]===Symbol.for("react.memo_cache_sentinel")?(qe=t.jsx(Pt,{className:"absolute left-2.5 top-2.5 h-4 w-4 text-gray-500"}),e[106]=qe):qe=e[106];let Ce;e[107]!==s.date_start||e[108]!==r?(Ce=Te=>{const ze=Te.target.value;if(T(ze),s.date_start){const rt=s.date_start.split(" ")[0].split("T")[0];r("date_start",`${rt} ${ze}`)}},e[107]=s.date_start,e[108]=r,e[109]=Ce):Ce=e[109];let we;e[110]!==Ce||e[111]!==d?(we=t.jsx("div",{className:"w-[120px]",children:t.jsxs("div",{className:"relative",children:[qe,t.jsx(mt,{type:"time",value:d,onChange:Ce,className:"pl-9"})]})}),e[110]=Ce,e[111]=d,e[112]=we):we=e[112],e[113]!==Se||e[114]!==we?(p=t.jsxs("div",{className:"flex gap-2",children:[Se,we]}),e[113]=Se,e[114]=we,e[115]=p):p=e[115],e[116]!==n.date_start?(_=n.date_start&&t.jsx("p",{className:"text-sm text-red-500",children:n.date_start}),e[116]=n.date_start,e[117]=_):_=e[117],e[118]!==s.date_start?(g=s.date_start&&!isNaN(new Date(s.date_start).getTime())&&t.jsxs("p",{className:"text-sm text-blue-600",children:["Khởi hành: ",t.jsx("span",{className:"font-medium",children:ft(new Date(s.date_start),"HH:mm, EEEE, 'ngày' dd 'tháng' MM 'năm' yyyy",{locale:Dt})})]}),e[118]=s.date_start,e[119]=g):g=e[119],F=me&&t.jsxs("p",{className:"text-sm text-gray-500",children:["Ngày kết thúc dự kiến:"," ",t.jsx("span",{className:"font-medium",children:new Date(me).toLocaleDateString("vi-VN")})]}),e[26]=s.date_start,e[27]=n.date_start,e[28]=$e,e[29]=et,e[30]=l.id,e[31]=r,e[32]=a.day,e[33]=a.id,e[34]=a.night,e[35]=a.title,e[36]=d,e[37]=D,e[38]=$,e[39]=V,e[40]=E,e[41]=x,e[42]=p,e[43]=_,e[44]=g,e[45]=F,e[46]=H,e[47]=j,e[48]=L,e[49]=M,e[50]=y,e[51]=I,e[52]=N,e[53]=b,e[54]=P,e[55]=v,e[56]=S}else D=e[37],$=e[38],V=e[39],E=e[40],x=e[41],p=e[42],_=e[43],g=e[44],F=e[45],H=e[46],j=e[47],L=e[48],M=e[49],y=e[50],I=e[51],N=e[52],b=e[53],P=e[54],v=e[55],S=e[56];let A;e[120]!==E||e[121]!==x||e[122]!==p||e[123]!==_||e[124]!==g||e[125]!==F?(A=t.jsxs("div",{className:E,children:[x,p,_,g,F]}),e[120]=E,e[121]=x,e[122]=p,e[123]=_,e[124]=g,e[125]=F,e[126]=A):A=e[126];let Me;e[127]===Symbol.for("react.memo_cache_sentinel")?(Me=t.jsx(ke,{htmlFor:"limit",children:"Số chỗ tối đa (để trống = không giới hạn)"}),e[127]=Me):Me=e[127];let B;e[128]!==r?(B=i=>r("limit",i.target.value),e[128]=r,e[129]=B):B=e[129];let G;e[130]!==s.limit||e[131]!==B?(G=t.jsx(mt,{id:"limit",type:"number",min:"1",value:s.limit,onChange:B,placeholder:"Ví dụ: 30",className:"max-w-xs"}),e[130]=s.limit,e[131]=B,e[132]=G):G=e[132];let K;e[133]!==n.limit?(K=n.limit&&t.jsx("p",{className:"text-sm text-red-500",children:n.limit}),e[133]=n.limit,e[134]=K):K=e[134];let R;e[135]!==l.booked_count?(R=t.jsxs("div",{className:"text-xs text-gray-500",children:["Đã đặt: ",l.booked_count," khách"]}),e[135]=l.booked_count,e[136]=R):R=e[136];let U;e[137]!==G||e[138]!==K||e[139]!==R?(U=t.jsxs("div",{className:"space-y-2",children:[Me,G,K,R]}),e[137]=G,e[138]=K,e[139]=R,e[140]=U):U=e[140];let Ie;e[141]===Symbol.for("react.memo_cache_sentinel")?(Ie=t.jsx(ke,{htmlFor:"price_adult",children:"Giá người lớn (VNĐ)"}),e[141]=Ie):Ie=e[141];let O;e[142]!==r?(O=i=>r("price_adult",i),e[142]=r,e[143]=O):O=e[143];let Q;e[144]!==s.price_adult||e[145]!==O?(Q=t.jsx(ut,{id:"price_adult",value:s.price_adult,onChange:O,placeholder:"Ví dụ: 5000000"}),e[144]=s.price_adult,e[145]=O,e[146]=Q):Q=e[146];let X;e[147]!==n.price_adult?(X=n.price_adult&&t.jsx("p",{className:"text-sm text-red-500",children:n.price_adult}),e[147]=n.price_adult,e[148]=X):X=e[148];let Y;e[149]!==Q||e[150]!==X?(Y=t.jsxs("div",{className:"space-y-2",children:[Ie,Q,X]}),e[149]=Q,e[150]=X,e[151]=Y):Y=e[151];let Pe;e[152]===Symbol.for("react.memo_cache_sentinel")?(Pe=t.jsx(ke,{htmlFor:"price_children",children:"Giá trẻ em (VNĐ)"}),e[152]=Pe):Pe=e[152];let q;e[153]!==r?(q=i=>r("price_children",i),e[153]=r,e[154]=q):q=e[154];let z;e[155]!==s.price_children||e[156]!==q?(z=t.jsx(ut,{id:"price_children",value:s.price_children,onChange:q,placeholder:"Ví dụ: 3000000"}),e[155]=s.price_children,e[156]=q,e[157]=z):z=e[157];let J;e[158]!==n.price_children?(J=n.price_children&&t.jsx("p",{className:"text-sm text-red-500",children:n.price_children}),e[158]=n.price_children,e[159]=J):J=e[159];let W;e[160]!==z||e[161]!==J?(W=t.jsxs("div",{className:"space-y-2",children:[Pe,z,J]}),e[160]=z,e[161]=J,e[162]=W):W=e[162];let Z;e[163]!==Y||e[164]!==W?(Z=t.jsxs("div",{className:"grid gap-4 sm:grid-cols-2",children:[Y,W]}),e[163]=Y,e[164]=W,e[165]=Z):Z=e[165];let Ae;e[166]===Symbol.for("react.memo_cache_sentinel")?(Ae=t.jsx(ke,{htmlFor:"status",children:"Trạng thái"}),e[166]=Ae):Ae=e[166];let ee;e[167]!==r?(ee=i=>r("status",i),e[167]=r,e[168]=ee):ee=e[168];let Be;e[169]===Symbol.for("react.memo_cache_sentinel")?(Be=t.jsx(St,{className:"max-w-xs",children:t.jsx(Ct,{})}),e[169]=Be):Be=e[169];let Ge;e[170]===Symbol.for("react.memo_cache_sentinel")?(Ge=t.jsxs(wt,{children:[t.jsx(Je,{value:"0",children:"Đã hủy"}),t.jsx(Je,{value:"1",children:"Sắp có"}),t.jsx(Je,{value:"2",children:"Đang diễn ra"}),t.jsx(Je,{value:"3",children:"Đã hoàn thành"})]}),e[170]=Ge):Ge=e[170];let te;e[171]!==s.status||e[172]!==ee?(te=t.jsxs(vt,{value:s.status,onValueChange:ee,children:[Be,Ge]}),e[171]=s.status,e[172]=ee,e[173]=te):te=e[173];let se;e[174]!==n.status?(se=n.status&&t.jsx("p",{className:"text-sm text-red-500",children:n.status}),e[174]=n.status,e[175]=se):se=e[175];let le;e[176]!==te||e[177]!==se?(le=t.jsxs("div",{className:"space-y-2",children:[Ae,te,se]}),e[176]=te,e[177]=se,e[178]=le):le=e[178];let ie;e[179]!==D||e[180]!==H||e[181]!==A||e[182]!==U||e[183]!==Z||e[184]!==le?(ie=t.jsxs(D,{className:H,children:[A,U,Z,le]}),e[179]=D,e[180]=H,e[181]=A,e[182]=U,e[183]=Z,e[184]=le,e[185]=ie):ie=e[185];let ae;e[186]!==$||e[187]!==j||e[188]!==ie?(ae=t.jsxs($,{children:[j,ie]}),e[186]=$,e[187]=j,e[188]=ie,e[189]=ae):ae=e[189];let Ke;e[190]===Symbol.for("react.memo_cache_sentinel")?(Ke=t.jsx(nt,{children:t.jsxs(ct,{className:"flex items-center gap-2",children:[t.jsx(It,{className:"h-5 w-5"})," Hướng dẫn viên (Lưu ý: chưa cập nhật logic xóa/thêm chi tiết trong prototype này, chỉ có thể thay đổi assignment)"]})}),e[190]=Ke):Ke=e[190];let re;e[191]!==s.guide_ids||e[192]!==f||e[193]!==tt?(re=t.jsxs(ot,{children:[Ke,t.jsx(dt,{children:f.length===0?t.jsx("p",{className:"text-sm text-gray-500",children:"Chưa có hướng dẫn viên nào trong hệ thống."}):t.jsx("div",{className:"space-y-3",children:f.map(i=>t.jsxs("div",{className:"flex items-center space-x-3 rounded-lg border p-3 hover:bg-gray-50",children:[t.jsx(bt,{id:`guide-${i.id}`,checked:s.guide_ids.includes(i.id),onCheckedChange:()=>tt(i.id),disabled:i.has_active_tour&&!s.guide_ids.includes(i.id)}),t.jsx(ke,{htmlFor:`guide-${i.id}`,className:"flex-1 cursor-pointer",children:t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{children:[t.jsx("span",{className:"font-medium",children:i.name}),i.has_active_tour&&!s.guide_ids.includes(i.id)&&t.jsx("span",{className:"ml-2 rounded bg-orange-100 px-1.5 py-0.5 text-xs font-medium text-orange-700",children:"Đã có tour"})]}),t.jsx("span",{className:"text-xs text-gray-500",children:i.email})]})})]},i.id))})})]}),e[191]=s.guide_ids,e[192]=f,e[193]=tt,e[194]=re):re=e[194];let Re;e[195]===Symbol.for("react.memo_cache_sentinel")?(Re=t.jsx(Ve,{type:"button",variant:"outline",onClick:At,children:"Hủy bỏ"}),e[195]=Re):Re=e[195];const st=Ee?"Đang lưu...":"Lưu thay đổi";let ne;e[196]!==Ee||e[197]!==st?(ne=t.jsxs("div",{className:"flex justify-end gap-4 border-t pt-6",children:[Re,t.jsx(Ve,{type:"submit",disabled:Ee,className:"min-w-[200px]",children:st})]}),e[196]=Ee,e[197]=st,e[198]=ne):ne=e[198];let ce;e[199]!==L||e[200]!==M||e[201]!==y||e[202]!==ae||e[203]!==re||e[204]!==ne?(ce=t.jsxs("form",{onSubmit:L,className:M,children:[y,ae,re,ne]}),e[199]=L,e[200]=M,e[201]=y,e[202]=ae,e[203]=re,e[204]=ne,e[205]=ce):ce=e[205];let de;e[206]!==I||e[207]!==N||e[208]!==b||e[209]!==ce?(de=t.jsxs("div",{className:I,children:[N,b,ce]}),e[206]=I,e[207]=N,e[208]=b,e[209]=ce,e[210]=de):de=e[210];let oe;e[211]!==P||e[212]!==de?(oe=t.jsx("div",{className:P,children:de}),e[211]=P,e[212]=de,e[213]=oe):oe=e[213];let Ue;return e[214]!==V||e[215]!==v||e[216]!==S||e[217]!==oe?(Ue=t.jsxs(V,{breadcrumbs:v,children:[S,oe]}),e[214]=V,e[215]=v,e[216]=S,e[217]=oe,e[218]=Ue):Ue=e[218],Ue}function At(){return window.history.back()}function Bt(){return window.history.back()}function Gt(w){_t.error("Không thể xóa chuyến đi (có thể đã có booking)")}function Kt(w){console.error("Errors:",w),_t.error("Có lỗi xảy ra khi cập nhật chuyến đi")}export{Cs as default};
