import{r as n,d as u,a as E,j as e,H as G,L as w}from"./app-Bzh0QcV-.js";import{B as q}from"./badge-GiRAufZZ.js";import{B as _}from"./button-DLyenbHO.js";import{b as S,C,a as L,c as $}from"./card-DwG3PsBo.js";import{T as z,a as U,b as x,c as p}from"./tabs-DO6_0zD4.js";import{t as A}from"./index-7ujUmCNw.js";import{t as o}from"./index-rXl9eqvF.js";import{A as F}from"./app-layout-CMbpVfDp.js";import K from"./TourGallery-BZTn8gSE.js";import R from"./TourGuideList-DeQXZ9bC.js";import W from"./TourHeader-bfiqOCmY.js";import J from"./TourInfoCards-adkq-ItA.js";import O from"./TourPolicyList-Cpn6OGzj.js";import Q from"./TourScheduleList-DEYp4ev9.js";import Y from"./TourServiceList-CVkYjh6o.js";import{C as P,U as Z}from"./users-C6EN8SYz.js";import{P as X}from"./plus-QDk8Rk0B.js";import{S as D}from"./square-pen-nPcrNPYr.js";import"./app-AjfTabGW.js";import"./utils-D0Zg16Wk.js";import"./index-Cs37kpNU.js";import"./index-DXbMLhRD.js";import"./index-3aTD3_kd.js";import"./createLucideIcon-Qg7y1Ni9.js";import"./index-CMWG4mbA.js";import"./x-Cc7sq3My.js";import"./avatar-DMx0EJxa.js";import"./index-Dhq0cQs_.js";import"./index-D9s5CDJa.js";import"./app-logo-icon-Cbb-6XH_.js";import"./index-31lGrPGR.js";import"./index-gSLmiL6w.js";import"./index-DaohGxKX.js";import"./index-2FGh3n-F.js";import"./index-CGelz8kl.js";import"./file-text-B2N7Qcbe.js";import"./trash-2-BzQ-ycRS.js";import"./arrow-left-DcITzwxY.js";import"./pencil-DdbMNkgJ.js";import"./helperInfoItem-DKlLLQSo.js";import"./dollar-sign-BKTW6sOm.js";import"./clock-Be8x_k56.js";import"./map-pin-DlqxZlVL.js";import"./eye-ClZbg0AX.js";import"./shield-check-CGX7z1UR.js";import"./separator-BKMpMzdz.js";import"./package-QrohFVys.js";const ee=s=>{const[d,c]=n.useState(!1);if(!s)return{galleryImages:[],schedules:[],tourServices:[],assignments:[],tourPolicies:[],loading:!1,refreshData:()=>{},deleteService:()=>{},deleteImage:()=>{},deleteSchedule:()=>{},deleteTour:()=>{},deletePolicy:()=>{},deleteAssignment:()=>{}};const[k,j]=n.useState(s.images||[]),[I,y]=n.useState(s.schedules||[]),[r,v]=n.useState(s.tour_services||s.tourServices||[]),[h,g]=n.useState(s.trip_assignments||s.tripAssignments||s.trip_assignments||[]),[N,f]=n.useState(s.tour_policies||s.tourPolicies||[]);return n.useEffect(()=>{j(s.images||[]),y(s.schedules||[]),v(s.tour_services||s.tour_services||[]),f(s.tour_policies||s.tour_policies||[]),g(s.trip_assignments||s.tripAssignments||s.trip_assignments||[])},[s]),{galleryImages:k,schedules:I,tourServices:r,tourPolicies:N,assignments:h,loading:d,refreshData:()=>{E.reload({only:["tour","template"],onStart:()=>c(!0),onFinish:()=>c(!1),preserveScroll:!0})},deleteImage:async(a,l)=>{c(!0);try{await u.delete(`/tours/${s.id}/images/${a}`),j(i=>i.filter(m=>m.id!==a)),o.success("Đã xóa ảnh thành công"),l&&l()}catch(i){console.error(i),o.error("Xóa ảnh thất bại")}finally{c(!1)}},deleteSchedule:async(a,l)=>{c(!0);try{await u.delete(`/tours/${s.id}/schedules/${a}`),y(i=>i.filter(m=>m.id!==a)),o.success("Đã xóa lịch trình"),l&&l()}catch(i){console.error(i),o.error("Xóa lịch trình thất bại")}finally{c(!1)}},deleteService:async(a,l)=>{c(!0);try{await u.delete(`/tours/${s.id}/tourservices/${a}`),v(i=>i.filter(m=>m.id!==a)),o.success("Đã xóa dịch vụ khỏi tour"),l&&l()}catch(i){console.error(i),o.error("Lỗi khi xóa dịch vụ")}finally{c(!1)}},deleteTour:a=>{E.delete(A.destroy(s.id).url,{onSuccess:()=>{o.success("Đã xóa tour thành công"),a&&a()},onError:()=>o.error("Xóa tour thất bại")})},deletePolicy:async(a,l)=>{c(!0);try{await u.delete(`/tours/${s.id}/tourpolicies/${a}`),f(i=>i.filter(m=>m.id!==a)),o.success("Đã xóa chính sách thành công"),l&&l()}catch(i){console.error(i),o.error("Lỗi khi xóa chính sách")}finally{c(!1)}},deleteAssignment:async(a,l)=>{c(!0);try{await u.delete(`/tours/${s.id}/assignments/${a}`),g(i=>i.filter(m=>m.id!==a)),o.success("Đã xóa hướng dẫn viên khỏi tour"),l&&l()}catch(i){console.error(i),o.error("Lỗi khi xóa hướng dẫn viên")}finally{c(!1)}}}};function Je({tour:s,template:d,categories:c,availableServices:k,availablePolicies:j,destinations:I,guides:y}){const r=d||s,h=(d?.instances||[]).sort((t,b)=>{const a=t.price_adult!==null,l=b.price_adult!==null;return a&&!l?-1:!a&&l?1:new Date(b.date_start).getTime()-new Date(t.date_start).getTime()});if(console.log("Tour data:",s),console.log("Template data:",d),console.log("TourData (final):",r),!r||!r.id)return e.jsxs(F,{breadcrumbs:[],children:[e.jsx(G,{title:"Lỗi"}),e.jsx("div",{className:"min-h-screen bg-gray-50 p-8",children:e.jsx("div",{className:"mx-auto max-w-6xl",children:e.jsxs("div",{className:"rounded-lg border border-red-200 bg-red-50 p-6",children:[e.jsx("h2",{className:"text-lg font-semibold text-red-800",children:"Không tìm thấy tour"}),e.jsx("p",{className:"mt-2 text-sm text-red-600",children:"Tour bạn đang tìm kiếm không tồn tại hoặc đã bị xóa."})]})})})]});const g=n.useMemo(()=>d&&d.trip_assignments?{...r,trip_assignments:d.trip_assignments}:r,[r,d]),{galleryImages:N,schedules:f,assignments:H,tourServices:T,tourPolicies:V}=ee(g),M=n.useMemo(()=>c.find(t=>t.id===r.category_id),[c,r.category_id]),B=n.useMemo(()=>[{title:"Danh Sách Tour",href:A.index().url},{title:`Chi tiết: ${r.title}`,href:r.id?A.show(r.id).url:"#"}],[r.id,r.title]);return e.jsxs(F,{breadcrumbs:B,children:[e.jsx(G,{title:`Chi tiết: ${r.title}`}),e.jsx("div",{className:"min-h-screen bg-gray-50 p-8",children:e.jsxs("div",{className:"mx-auto max-w-6xl",children:[e.jsx(W,{tour:r,categoryName:M?.title}),e.jsx("div",{className:"mt-6",children:e.jsxs(z,{defaultValue:"overview",className:"w-full",children:[e.jsxs(U,{className:"w-full justify-start overflow-x-auto flex-nowrap h-auto p-1 bg-white rounded-lg border",children:[e.jsx(x,{value:"overview",className:"flex-1 min-w-[100px] whitespace-nowrap",children:"Tổng quan"}),e.jsx(x,{value:"schedule",className:"flex-1 min-w-[100px] whitespace-nowrap",children:"Lịch trình"}),e.jsx(x,{value:"services",className:"flex-1 min-w-[150px] whitespace-nowrap",children:"Dịch vụ & Chính sách"}),e.jsx(x,{value:"departures",className:"flex-1 min-w-[120px] whitespace-nowrap",children:"Lịch khởi hành"}),e.jsx(x,{value:"guides",className:"flex-1 min-w-[120px] whitespace-nowrap",children:"Hướng dẫn viên"})]}),e.jsx(p,{value:"overview",className:"mt-6 space-y-6",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"md:col-span-2 space-y-6",children:[e.jsx(K,{tour:r,images:N}),e.jsxs(S,{children:[e.jsx(C,{children:e.jsx(L,{children:"Mô tả chi tiết"})}),e.jsx($,{children:e.jsx("div",{className:"prose max-w-none text-gray-700",children:r.description?e.jsx("div",{dangerouslySetInnerHTML:{__html:r.description}}):e.jsx("p",{className:"text-gray-500 italic",children:"Chưa có mô tả chi tiết cho tour này."})})})]})]}),e.jsx("div",{className:"space-y-6",children:e.jsx(J,{tour:r,instances:h})})]})}),e.jsx(p,{value:"schedule",className:"mt-6",children:e.jsx(Q,{schedules:f})}),e.jsxs(p,{value:"services",className:"mt-6 space-y-6",children:[e.jsx(Y,{tourServices:T}),e.jsx(O,{tourPolicies:V})]}),e.jsx(p,{value:"departures",className:"mt-6",children:e.jsx("div",{className:"space-y-6",children:h.length>0?e.jsxs(S,{children:[e.jsxs(C,{className:"flex flex-row items-center justify-between pb-2",children:[e.jsxs(L,{className:"flex items-center gap-2 text-base",children:[e.jsx(P,{className:"h-5 w-5 text-blue-600"})," Danh sách Chuyến Đi"]}),e.jsx(w,{href:`/tours/${r.id}/instances/create`,children:e.jsxs(_,{variant:"outline",size:"sm",className:"gap-1",children:[e.jsx(X,{className:"h-4 w-4"})," Tạo chuyến đi mới"]})})]}),e.jsx($,{children:e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:h.map(t=>e.jsxs("div",{className:"rounded-lg border p-4 hover:bg-gray-50 bg-white shadow-sm flex flex-col justify-between",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx(q,{variant:"secondary",className:`${t.status===0?"bg-red-100 text-red-800":t.status===1?"bg-yellow-100 text-yellow-800":t.status===2?"bg-blue-100 text-blue-800":"bg-green-100 text-green-800"}`,children:t.status===0?"Đã hủy":t.status===1?"Sắp có":t.status===2?"Đang diễn ra":"Đã hoàn thành"}),e.jsx(w,{href:`/tour-instances/${t.id}/edit`,children:e.jsx(_,{size:"icon",variant:"ghost",className:"h-8 w-8 text-gray-400 hover:text-blue-600",children:e.jsx(D,{className:"h-4 w-4"})})})]}),e.jsx("h3",{className:"font-semibold text-lg text-blue-700 mb-1",children:new Date(t.date_start).toLocaleDateString("vi-VN")}),e.jsxs("p",{className:"text-sm text-gray-500 mb-3",children:["đến ",new Date(t.date_end).toLocaleDateString("vi-VN")]}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"flex justify-between border-b pb-1",children:[e.jsx("span",{className:"text-gray-600",children:"Giá người lớn:"}),e.jsx("span",{className:"font-medium",children:t.price_adult?new Intl.NumberFormat("vi-VN",{style:"currency",currency:"VND"}).format(t.price_adult):"N/A"})]}),e.jsxs("div",{className:"flex justify-between border-b pb-1",children:[e.jsx("span",{className:"text-gray-600",children:"Trẻ em:"}),e.jsx("span",{className:"font-medium",children:t.price_children?new Intl.NumberFormat("vi-VN",{style:"currency",currency:"VND"}).format(t.price_children):"N/A"})]})]})]}),e.jsxs("div",{className:"mt-4 pt-3 border-t flex items-center justify-between text-sm",children:[e.jsxs("span",{className:"flex items-center gap-1 text-gray-600",children:[e.jsx(Z,{className:"h-4 w-4"}),"Chỗ:"]}),e.jsxs("span",{className:"font-medium",children:[t.booked_count," / ",t.limit||"∞"]})]})]},t.id))})})]}):e.jsxs(S,{children:[e.jsx(C,{children:e.jsxs(L,{className:"flex items-center gap-2 text-base",children:[e.jsx(P,{className:"h-5 w-5 text-blue-600"})," Chuyến Đi"]})}),e.jsxs($,{className:"text-center py-8",children:[e.jsx(P,{className:"h-12 w-12 mx-auto text-gray-300 mb-3"}),e.jsx("p",{className:"text-gray-500 mb-4",children:"Chưa có chuyến đi nào được tạo cho tour này."}),e.jsx(w,{href:`/tours/${r.id}/instances/create`,children:e.jsxs(_,{children:[e.jsx(X,{className:"mr-2 h-4 w-4"})," Tạo chuyến đi đầu tiên"]})})]})]})})}),e.jsx(p,{value:"guides",className:"mt-6",children:e.jsx(R,{assignments:H})})]})})]})})]})}export{Je as default};
